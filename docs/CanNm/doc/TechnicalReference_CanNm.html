---
layout: default
title: TechnicalReference_CanNm
nav_order: 2
parent: CAN Network Management
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR CAN Network Management </b></p>
<p>Technical Reference </p>
<p> </p>
<p>Nm_Asr4NmCan </p>
<p>Version 6.02.00 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>Markus Schuster </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>2 </p>
<p>based on template version 5.2.0 </p>
<p><b>Document Information </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>Markus Schuster </p>
<p>2012-08-08 </p>
<p>1.00.00 </p>
<p>ESCAN00058396 Creation </p>
<p>Markus Drescher </p>
<p>2013-05-10 </p>
<p>1.01.00 </p>
<p>ESCAN00063144 Updated Architecture </p>
<p>Overview </p>
<p>ESCAN00064972 Support of Variant Post-</p>
<p>Build-Loadable </p>
<p>ESCAN00065301 Improved send behavior </p>
<p>descriptions in chapter 3.6.3 and </p>
<p>Immediate Nm Transmission feature </p>
<p>descriptions in chapters 3.15 and 3.16 </p>
<p>ESCAN00065574 Extended chapter 3.13 </p>
<p>ESCAN00067271 Merged chapter </p>
<p>‘AUTOSAR Standard Compliance’ with </p>
<p>chapter 3, removed ‘Compiler Abstraction </p>
<p>and Memory Mapping’ chapter, various </p>
<p>improvements </p>
<p>ESCAN00067277 Adapted chapter 5.3.1.1 </p>
<p>ESCAN00067278 Replaced </p>
<p>Nm_PrepareBusSleep by </p>
<p>Nm_PrepareBusSleepMode </p>
<p>Markus Drescher </p>
<p>2013-10-01 </p>
<p>2.00.00 </p>
<p>ESCAN00067700 Added Runtime </p>
<p>Measurement Support to ‘Features Beyond </p>
<p>the AUTOSAR Standard’ </p>
<p>ESCAN00070810 Updated Architecture </p>
<p>Overview </p>
<p>Markus Drescher </p>
<p>2014-02-24 </p>
<p>2.01.00 </p>
<p>ESCAN00072375 Adapted condition for </p>
<p>usage of CanSM_TxTimeoutException in </p>
<p>chapter 5.4 </p>
<p>ESCAN00073874 Updated Architecture </p>
<p>Overview </p>
<p>Markus Schuster </p>
<p>2014-05-12 </p>
<p>3.00.00 </p>
<p>ESCAN00075248 Add description of </p>
<p>dependency of Bus Load Reduction and </p>
<p>Partial Networking feature on the same </p>
<p>channel in chapter 3.6.4 </p>
<p>Markus Schuster </p>
<p>2014-10-09 </p>
<p>4.00.00 </p>
<p>ESCAN00076763 Added description in </p>
<p>chapter 1, 3.1.2 and 5.3.1.1. Removed </p>
<p>chapter 5.2 ‘Type Definitions’ </p>
<p>ESCAN00078817 Added description in </p>
<p>chapter 3.1.1 </p>
<p>Markus Schuster </p>
<p>2015-06-03 </p>
<p>5.00.00 </p>
<p>ESCAN00082408 Updated Table 3-1 and </p>
<p>Table 3-3, Table 3-7 </p>
<p>Markus Schuster </p>
<p>2016-03-02 </p>
<p>6.00.00 </p>
<p>ESCAN00086897 Adapted chapter 3.4 </p>
<p>ESCAN00087953 Adapted chapter 3.8 </p>
<p>ESCAN00087415 Adapted chapter 3.1.1 </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>3 </p>
<p>based on template version 5.2.0 </p>
<p>Markus Schuster </p>
<p>2016-05-09 </p>
<p>6.01.00 </p>
<p>ESCAN00089821 Adapted chapter 3.1 </p>
<p>ESCAN00090105 Adapted chapter 3.18.3 </p>
<p>ESCAN00090927 Added chapter 3.5.2.1 </p>
<p>Markus Schuster </p>
<p>2016-11-17 </p>
<p>6.02.00 </p>
<p>FEATC-58 Adapted chapter 3.11 </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Source </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SRS_NetworkManagement.pdf </p>
<p>3.0.0 </p>
<p>[2] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_CANInterface.pdf </p>
<p>5.0.0 </p>
<p>[3] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_CANNetworkManagement.pdf </p>
<p>3.3.0 </p>
<p>[4] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_DiagnosticEventManager.pdf </p>
<p>4.2.0 </p>
<p>[5] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_DevelopmentErrorTracer.pdf </p>
<p>3.2.0 </p>
<p>[6] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_TR_BSWModuleList.pdf </p>
<p>1.6.0 </p>
<p>[7] </p>
<p> AUTOSAR </p>
<p>AUTOSAR_SWS_RTE.pdf </p>
<p>3.2.0 </p>
<p>[8] </p>
<p> Vector </p>
<p>Technical Reference MICROSAR PDU Router </p>
<p>See </p>
<p>delivery </p>
<p>Table 1-1  </p>
<p>Reference Documents </p>
<p>Scope of the Document  </p>
<p>This technical reference describes the specific use of the CAN Network Management </p>
<p>basic software. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>We have configured the programs in accordance with your specifications in the </p>
<p>questionnaire. Whereas the programs do support other configurations than the one </p>
<p>specified in your questionnaire, Vector’s release of the programs delivered to your </p>
<p>company is expressly restricted to the configuration you have specified in the </p>
<p>questionnaire. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>4 </p>
<p>based on template version 5.2.0 </p>
<p><b>Contents </b></p>
<p><b>1.</b></p>
<p> </p>
<p><b>Component History ...................................................................................................... 10</b></p>
<p> </p>
<p><b>2.</b></p>
<p> </p>
<p><b>Introduction .................................................................................................................. 11</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>Naming Conventions .............................................................................................. 11</p>
<p> </p>
<p>2.2</p>
<p> </p>
<p>Architecture Overview ............................................................................................ 12</p>
<p> </p>
<p>2.2.1</p>
<p> </p>
<p>Architecture of AUTOSAR Network Management .......................................... 12</p>
<p> </p>
<p><b>3.</b></p>
<p> </p>
<p><b>Functional Description ................................................................................................ 14</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Features ................................................................................................................. 14</p>
<p> </p>
<p>3.1.1</p>
<p> </p>
<p>Deviations Against AUTOSAR ....................................................................... 15</p>
<p> </p>
<p>3.1.1.1</p>
<p> </p>
<p>RAM Initialization .................................................................................... 15</p>
<p> </p>
<p>3.1.1.2</p>
<p> </p>
<p>Additional Configuration Dependencies .................................................. 15</p>
<p> </p>
<p>3.1.1.3</p>
<p> </p>
<p>Variant Post-Build ................................................................................... 15</p>
<p> </p>
<p>3.1.2</p>
<p> </p>
<p>Additions/ Extensions .................................................................................... 15</p>
<p> </p>
<p>3.1.2.1</p>
<p> </p>
<p>Single Channel Optimization .................................................................. 16</p>
<p> </p>
<p>3.1.2.2</p>
<p> </p>
<p>Memory Initialization ............................................................................... 16</p>
<p> </p>
<p>3.1.2.3</p>
<p> </p>
<p>Disable Transmission Error Reporting .................................................... 16</p>
<p> </p>
<p>3.1.2.4</p>
<p> </p>
<p>Calling CanNm_PassiveStartUp in Prepare Bus Sleep ........................... 16</p>
<p> </p>
<p>3.1.2.5</p>
<p> </p>
<p>Additional Development Error Codes ...................................................... 16</p>
<p> </p>
<p>3.1.2.6</p>
<p> </p>
<p>Variable DLC Support ............................................................................. 16</p>
<p> </p>
<p>3.1.2.7</p>
<p> </p>
<p>Changeability of Additional Parameters During the Post-Build Phase ..... 17</p>
<p> </p>
<p>3.1.3</p>
<p> </p>
<p>Limitations ..................................................................................................... 17</p>
<p> </p>
<p>3.1.3.1</p>
<p> </p>
<p>Ranges of Timers ................................................................................... 17</p>
<p> </p>
<p>3.1.3.2</p>
<p> </p>
<p>Effects of CanNm_DisableCommunication ............................................. 17</p>
<p> </p>
<p>3.1.3.3</p>
<p> </p>
<p>CANNM_E_NET_START_IND Development Error ................................. 17</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Network Management Mechanism ......................................................................... 17</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>Initialization ............................................................................................................ 19</p>
<p> </p>
<p>3.4</p>
<p> </p>
<p>Passive Mode ......................................................................................................... 19</p>
<p> </p>
<p>3.5</p>
<p> </p>
<p>Operation Modes and States .................................................................................. 19</p>
<p> </p>
<p>3.5.1</p>
<p> </p>
<p>Network Mode ............................................................................................... 20</p>
<p> </p>
<p>3.5.1.1</p>
<p> </p>
<p>Repeat Message State ........................................................................... 21</p>
<p> </p>
<p>3.5.1.2</p>
<p> </p>
<p>Normal Operation State .......................................................................... 21</p>
<p> </p>
<p>3.5.1.3</p>
<p> </p>
<p>Ready Sleep State ................................................................................. 21</p>
<p> </p>
<p>3.5.2</p>
<p> </p>
<p>Prepare Bus-Sleep Mode .............................................................................. 21</p>
<p> </p>
<p>3.5.2.1</p>
<p> </p>
<p>Wait Bus Sleep Extensions ..................................................................... 22</p>
<p> </p>
<p>3.5.3</p>
<p> </p>
<p>Bus-Sleep Mode ............................................................................................ 23</p>
<p> </p>
<p>3.5.4</p>
<p> </p>
<p>Wake-up Registration .................................................................................... 23</p>
<p> </p>
<p>3.5.5</p>
<p> </p>
<p>User Data Handling ....................................................................................... 23</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>5 </p>
<p>based on template version 5.2.0 </p>
<p>3.6</p>
<p> </p>
<p>Network Management Message Transmission and Reception ............................... 24</p>
<p> </p>
<p>3.6.1</p>
<p> </p>
<p>AUTOSAR CAN Interface.............................................................................. 24</p>
<p> </p>
<p>3.6.2</p>
<p> </p>
<p>PDU Message Layout ................................................................................... 24</p>
<p> </p>
<p>3.6.3</p>
<p> </p>
<p>Message Transmissions ................................................................................ 25</p>
<p> </p>
<p>3.6.4</p>
<p> </p>
<p>Bus Load Reduction ...................................................................................... 26</p>
<p> </p>
<p>3.6.5</p>
<p> </p>
<p>Support for RX PDUs with Different Lengths ................................................. 26</p>
<p> </p>
<p>3.7</p>
<p> </p>
<p>Node Detection ...................................................................................................... 27</p>
<p> </p>
<p>3.8</p>
<p> </p>
<p>NM PDU Receive Indication ................................................................................... 28</p>
<p> </p>
<p>3.9</p>
<p> </p>
<p>Communication Control .......................................................................................... 28</p>
<p> </p>
<p>3.10</p>
<p> </p>
<p>Gateway Functionality ............................................................................................ 28</p>
<p> </p>
<p>3.10.1</p>
<p> </p>
<p>Remote Sleep Indication and Cancellation .................................................... 28</p>
<p> </p>
<p>3.10.2</p>
<p> </p>
<p>Bus Synchronization ..................................................................................... 29</p>
<p> </p>
<p>3.11</p>
<p> </p>
<p>Coordinator Synchronization Support ..................................................................... 29</p>
<p> </p>
<p>3.12</p>
<p> </p>
<p>Error Handling ........................................................................................................ 29</p>
<p> </p>
<p>3.12.1</p>
<p> </p>
<p>Development Error Detection ........................................................................ 29</p>
<p> </p>
<p>3.12.1.1</p>
<p> </p>
<p>Det_ReportError ..................................................................................... 30</p>
<p> </p>
<p>3.12.1.2</p>
<p> </p>
<p>Parameter Checking ............................................................................... 31</p>
<p> </p>
<p>3.12.2</p>
<p> </p>
<p>Production Code Error Reporting .................................................................. 32</p>
<p> </p>
<p>3.13</p>
<p> </p>
<p>Com User Data Support ......................................................................................... 32</p>
<p> </p>
<p>3.13.1</p>
<p> </p>
<p>Configuration Preconditions in an AUTOSAR ECU Configuration .................. 33</p>
<p> </p>
<p>3.14</p>
<p> </p>
<p>Active Wake-up Handling ....................................................................................... 34</p>
<p> </p>
<p>3.15</p>
<p> </p>
<p>Immediate Nm Transmissions ................................................................................ 34</p>
<p> </p>
<p>3.16</p>
<p> </p>
<p>Immediate Restart Enabled .................................................................................... 36</p>
<p> </p>
<p>3.17</p>
<p> </p>
<p>Car Wake-up .......................................................................................................... 37</p>
<p> </p>
<p>3.17.1</p>
<p> </p>
<p>Rx-Path ......................................................................................................... 37</p>
<p> </p>
<p>3.17.2</p>
<p> </p>
<p>Tx-Path ......................................................................................................... 37</p>
<p> </p>
<p>3.18</p>
<p> </p>
<p>Partial Networking .................................................................................................. 37</p>
<p> </p>
<p>3.18.1</p>
<p> </p>
<p>Availability of Partial Network Request Information ....................................... 38</p>
<p> </p>
<p>3.18.2</p>
<p> </p>
<p>Transmission of the CRI Bit in the NM User Data .......................................... 38</p>
<p> </p>
<p>3.18.3</p>
<p> </p>
<p>Filter Algorithm for Received NM Messages .................................................. 38</p>
<p> </p>
<p>3.18.4</p>
<p> </p>
<p>Aggregation of Requested Partial Networks .................................................. 38</p>
<p> </p>
<p>3.18.5</p>
<p> </p>
<p>Spontaneous Sending of NM Messages........................................................ 39</p>
<p> </p>
<p>3.18.5.1</p>
<p> </p>
<p>Using Com Transmission on Change Mechanism .................................. 39</p>
<p> </p>
<p>3.18.5.2</p>
<p> </p>
<p>Using NM Request and Immediate Nm Transmission ............................. 39</p>
<p> </p>
<p><b>4.</b></p>
<p> </p>
<p><b>Integration .................................................................................................................... 40</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Scope of Delivery ................................................................................................... 40</p>
<p> </p>
<p>4.1.1</p>
<p> </p>
<p>Static Files .................................................................................................... 40</p>
<p> </p>
<p>4.1.2</p>
<p> </p>
<p>Dynamic Files ............................................................................................... 40</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Include Structure .................................................................................................... 41</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>Main Functions ....................................................................................................... 42</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>6 </p>
<p>based on template version 5.2.0 </p>
<p>4.4</p>
<p> </p>
<p>Critical Sections ..................................................................................................... 42</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>Critical Section Codes ............................................................................................ 42</p>
<p> </p>
<p><b>5.</b></p>
<p> </p>
<p><b>API Description ............................................................................................................ 44</b></p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>Data Types ............................................................................................................. 44</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Global Constants .................................................................................................... 44</p>
<p> </p>
<p>5.2.1</p>
<p> </p>
<p>AUTOSAR Specification Version ................................................................... 44</p>
<p> </p>
<p>5.2.2</p>
<p> </p>
<p>Component Versions ..................................................................................... 44</p>
<p> </p>
<p>5.2.3</p>
<p> </p>
<p>Vendor and Module ID ................................................................................... 44</p>
<p> </p>
<p>5.3</p>
<p> </p>
<p>Services Provided by CANNM ................................................................................ 46</p>
<p> </p>
<p>5.3.1</p>
<p> </p>
<p>Administrative Functions ............................................................................... 46</p>
<p> </p>
<p>5.3.1.1</p>
<p> </p>
<p>CanNm_Init: Initialization of CAN NM ..................................................... 46</p>
<p> </p>
<p>5.3.1.2</p>
<p> </p>
<p>CanNm_MainFunction: Main Function for All Channel Instances ............ 46</p>
<p> </p>
<p>5.3.1.3</p>
<p> </p>
<p>CanNm_InitMemory: Memory Initialization ............................................. 47</p>
<p> </p>
<p>5.3.2</p>
<p> </p>
<p>Service Functions .......................................................................................... 47</p>
<p> </p>
<p>5.3.2.1</p>
<p> </p>
<p>CanNm_GetVersionInfo: Version Information API ................................... 47</p>
<p> </p>
<p>5.3.2.2</p>
<p> </p>
<p>CanNm_GetState: Get the State of the Network Management ............... 48</p>
<p> </p>
<p>5.3.2.3</p>
<p> </p>
<p>CanNm_PassiveStartUp: Wake up the Network Management................ 49</p>
<p> </p>
<p>5.3.2.4</p>
<p> </p>
<p>Wake-up Registration ............................................................................. 49</p>
<p> </p>
<p>5.3.2.4.1</p>
<p> </p>
<p>CanNm_NetworkRequest: Request the Network ............................. 49</p>
<p> </p>
<p>5.3.2.4.2</p>
<p> </p>
<p>CanNm_NetworkRelease: Release the Network .............................. 50</p>
<p> </p>
<p>5.3.2.5</p>
<p> </p>
<p>User Data Handling ................................................................................ 50</p>
<p> </p>
<p>5.3.2.5.1</p>
<p> </p>
<p>CanNm_SetUserData: Set User Data .............................................. 50</p>
<p> </p>
<p>5.3.2.5.2</p>
<p> </p>
<p>CanNm_GetUserData: Get User Data ............................................. 51</p>
<p> </p>
<p>5.3.2.5.3</p>
<p> </p>
<p>CanNm_GetPduData: Get NM PDU Data ........................................ 51</p>
<p> </p>
<p>5.3.2.6</p>
<p> </p>
<p>Node Detection....................................................................................... 52</p>
<p> </p>
<p>5.3.2.6.1</p>
<p> </p>
<p>CanNm_RepeatMessageRequest: Set Repeat Message </p>
<p>Request Bit ...................................................................................... 52</p>
<p> </p>
<p>5.3.2.6.2</p>
<p> </p>
<p>CanNm_GetNodeIdentifier: Get Node Identifier ............................... 53</p>
<p> </p>
<p>5.3.2.6.3</p>
<p> </p>
<p>CanNm_GetLocalNodeIdentifier: Get Local Node Identifier ............. 53</p>
<p> </p>
<p>5.3.2.7</p>
<p> </p>
<p>Bus Synchronization ............................................................................... 54</p>
<p> </p>
<p>5.3.2.7.1</p>
<p> </p>
<p>CanNm_RequestBusSynchronization: Synchronization of </p>
<p>Networks ......................................................................................... 54</p>
<p> </p>
<p>5.3.2.8</p>
<p> </p>
<p>Remote Sleep Indication ........................................................................ 54</p>
<p> </p>
<p>5.3.2.8.1</p>
<p> </p>
<p>CanNm_CheckRemoteSleepIndication: Check for Remote </p>
<p>Sleep Indication ............................................................................... 54</p>
<p> </p>
<p>5.3.2.9</p>
<p> </p>
<p>NM Message Transmission Request ...................................................... 55</p>
<p> </p>
<p>5.3.2.9.1</p>
<p> </p>
<p>CanNm_Transmit: Spontaneous NM Message Transmission .......... 55</p>
<p> </p>
<p>5.3.2.10</p>
<p> </p>
<p>Communication Control Service ............................................................. 56</p>
<p> </p>
<p>5.3.2.10.1</p>
<p> </p>
<p>CanNm_DisableCommunication: Disable NM Message </p>
<p>Transmission ................................................................................... 56</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>7 </p>
<p>based on template version 5.2.0 </p>
<p>5.3.2.10.2</p>
<p> </p>
<p>CanNm_EnableCommunication: Enabled NM Message </p>
<p>Transmission ................................................................................... 56</p>
<p> </p>
<p>5.3.2.11</p>
<p> </p>
<p>Coordinator Synchronization Support ..................................................... 57</p>
<p> </p>
<p>5.3.2.11.1</p>
<p> </p>
<p>CanNm_SetSleepReadyBit: Set Sleep Ready Bit in the CBV .......... 57</p>
<p> </p>
<p>5.4</p>
<p> </p>
<p>Services Used by CANNM ..................................................................................... 58</p>
<p> </p>
<p>5.5</p>
<p> </p>
<p>Callback Functions ................................................................................................. 59</p>
<p> </p>
<p>5.5.1</p>
<p> </p>
<p>Callback Functions from CAN Interface ......................................................... 59</p>
<p> </p>
<p>5.5.1.1</p>
<p> </p>
<p>CanNm_TxConfirmation: NM Message Confirmation Function ............... 59</p>
<p> </p>
<p>5.5.1.2</p>
<p> </p>
<p>CanNm_RxIndication: NM Message Indication ....................................... 59</p>
<p> </p>
<p>5.5.2</p>
<p> </p>
<p>Callback Function from CAN State Manager ................................................. 60</p>
<p> </p>
<p>5.5.2.1</p>
<p> </p>
<p>CanNm_ConfirmPnAvailability: Notification for Activating the PN Filter </p>
<p>Functionality ........................................................................................... 60</p>
<p> </p>
<p><b>6.</b></p>
<p> </p>
<p><b>Glossary and Abbreviations ........................................................................................ 61</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Glossary ................................................................................................................. 61</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Abbreviations ......................................................................................................... 61</p>
<p> </p>
<p><b>7.</b></p>
<p> </p>
<p><b>Contact.......................................................................................................................... 63</b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>8 </p>
<p>based on template version 5.2.0 </p>
<p><b>Illustrations </b></p>
<p>Figure 2-1</p>
<p> </p>
<p>AUTOSAR 4.x Architecture Overview ....................................................... 12</p>
<p> </p>
<p>Figure 2-2</p>
<p> </p>
<p>Interfaces to adjacent modules of the CANNM ......................................... 13</p>
<p> </p>
<p>Figure 3-1</p>
<p> </p>
<p>State Diagram of CAN NM from SWS CAN NM [3] ................................... 18</p>
<p> </p>
<p>Figure 3-2</p>
<p> </p>
<p>Usual Behavior of NM Transmissions when Repeat Message is entered .. 25</p>
<p> </p>
<p>Figure 3-3</p>
<p> </p>
<p>Immediate Transmission due to Signal Change inside User Data I-PDU .. 33</p>
<p> </p>
<p>Figure 3-4</p>
<p> </p>
<p>Immediate Nm Transmissions ................................................................... 35</p>
<p> </p>
<p>Figure 3-5</p>
<p> </p>
<p>Behavior for NM Transmissions if Immediate Restart Enabled is ON ........ 36</p>
<p> </p>
<p>Figure 4-1</p>
<p> </p>
<p>Include structure ....................................................................................... 41</p>
<p> </p>
<p><b> </b></p>
<p><b>Tables </b></p>
<p>Table 1-1 </p>
<p> </p>
<p>Reference Documents ................................................................................ 3</p>
<p> </p>
<p>Table 1-1 </p>
<p> </p>
<p>Component history.................................................................................... 10</p>
<p> </p>
<p>Table 2-1 </p>
<p> </p>
<p>Naming Conventions ................................................................................ 11</p>
<p> </p>
<p>Table 3-1 </p>
<p> </p>
<p>Supported AUTOSAR standard conform features ..................................... 15</p>
<p> </p>
<p>Table 3-2 </p>
<p> </p>
<p>Not supported AUTOSAR standard conform features ............................... 15</p>
<p> </p>
<p>Table 3-3 </p>
<p> </p>
<p>Features provided beyond the AUTOSAR standard .................................. 16</p>
<p> </p>
<p>Table 3-4 </p>
<p> </p>
<p>PDU NM Message Layout ........................................................................ 24</p>
<p> </p>
<p>Table 3-5 </p>
<p> </p>
<p>Control Bit Vector ...................................................................................... 25</p>
<p> </p>
<p>Table 3-6 </p>
<p> </p>
<p>Service IDs ............................................................................................... 30</p>
<p> </p>
<p>Table 3-7 </p>
<p> </p>
<p>Errors reported to DET ............................................................................. 31</p>
<p> </p>
<p>Table 3-8 </p>
<p> </p>
<p>Development Error Reporting: Assignment of checks to services ............. 32</p>
<p> </p>
<p>Table 3-9 </p>
<p> </p>
<p>Errors reported to DEM ............................................................................. 32</p>
<p> </p>
<p>Table 3-10 </p>
<p> </p>
<p>Configuration Precondition Overview for AUTOSAR ECU Configurations . 34</p>
<p> </p>
<p>Table 4-1 </p>
<p> </p>
<p>Static files ................................................................................................. 40</p>
<p> </p>
<p>Table 4-2 </p>
<p> </p>
<p>Generated files ......................................................................................... 40</p>
<p> </p>
<p>Table 4-3 </p>
<p> </p>
<p>Critical Section Codes .............................................................................. 43</p>
<p> </p>
<p>Table 5-1 </p>
<p> </p>
<p>Specification Version API Data ................................................................. 44</p>
<p> </p>
<p>Table 5-2 </p>
<p> </p>
<p>Component Version API Data ................................................................... 44</p>
<p> </p>
<p>Table 5-3 </p>
<p> </p>
<p>Vendor/Module ID ..................................................................................... 45</p>
<p> </p>
<p>Table 5-4 </p>
<p> </p>
<p>CanNm_Init .............................................................................................. 46</p>
<p> </p>
<p>Table 5-5 </p>
<p> </p>
<p>CanNm_MainFunction .............................................................................. 47</p>
<p> </p>
<p>Table 5-6 </p>
<p> </p>
<p>CanNm_InitMemory .................................................................................. 47</p>
<p> </p>
<p>Table 5-7 </p>
<p> </p>
<p>CanNm_GetVersionInfo ............................................................................ 48</p>
<p> </p>
<p>Table 5-8 </p>
<p> </p>
<p>CanNm_GetState ..................................................................................... 48</p>
<p> </p>
<p>Table 5-9 </p>
<p> </p>
<p>CanNm_PassiveStartUp ........................................................................... 49</p>
<p> </p>
<p>Table 5-10 </p>
<p> </p>
<p>CanNm_NetworkRequest ......................................................................... 50</p>
<p> </p>
<p>Table 5-11 </p>
<p> </p>
<p>CanNm_NetworkRelease ......................................................................... 50</p>
<p> </p>
<p>Table 5-12 </p>
<p> </p>
<p>CanNm_SetUserData ............................................................................... 51</p>
<p> </p>
<p>Table 5-13 </p>
<p> </p>
<p>CanNm_GetUserData ............................................................................... 51</p>
<p> </p>
<p>Table 5-14 </p>
<p> </p>
<p>CanNm_GetPduData ................................................................................ 52</p>
<p> </p>
<p>Table 5-15 </p>
<p> </p>
<p>CanNm_RepeatMessageRequest ............................................................ 52</p>
<p> </p>
<p>Table 5-16 </p>
<p> </p>
<p>CanNm_GetNodeIdentifier........................................................................ 53</p>
<p> </p>
<p>Table 5-17 </p>
<p> </p>
<p>CanNm_GetLocalNodeIdentifier ............................................................... 54</p>
<p> </p>
<p>Table 5-18 </p>
<p> </p>
<p>CanNm_RequestBusSynchronization ....................................................... 54</p>
<p> </p>
<p>Table 5-19 </p>
<p> </p>
<p>CanNm_CheckRemoteSleepIndication ..................................................... 55</p>
<p> </p>
<p>Table 5-20 </p>
<p> </p>
<p>CanNm_Transmit ...................................................................................... 56</p>
<p> </p>
<p>Table 5-21 </p>
<p> </p>
<p>CanNm_DisableCommunication ............................................................... 56</p>
<p> </p>
<p>Table 5-22 </p>
<p> </p>
<p>CanNm_EnableCommunication ................................................................ 57</p>
<p> </p>
<p>Table 5-23 </p>
<p> </p>
<p>CanNm_SetSleepReadyBit ....................................................................... 57</p>
<p> </p>
<p>Table 5-24 </p>
<p> </p>
<p>Services used by the CANNM .................................................................. 58</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>9 </p>
<p>based on template version 5.2.0 </p>
<p>Table 5-25 </p>
<p> </p>
<p>CanNm_TxConfirmation ........................................................................... 59</p>
<p> </p>
<p>Table 5-26 </p>
<p> </p>
<p>CanNm_RxIndication ................................................................................ 60</p>
<p> </p>
<p>Table 5-27 </p>
<p> </p>
<p>CanNm_ConfirmPnAvailability .................................................................. 60</p>
<p> </p>
<p>Table 6-1 </p>
<p> </p>
<p>Glossary ................................................................................................... 61</p>
<p> </p>
<p>Table 6-2 </p>
<p> </p>
<p>Abbreviations ............................................................................................ 62</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>10 </p>
<p>based on template version 5.2.0 </p>
<p><b>1. </b></p>
<p><b>Component History </b></p>
<p>The </p>
<p>component </p>
<p>history </p>
<p>gives </p>
<p>an </p>
<p>overview </p>
<p>over </p>
<p>the </p>
<p>important </p>
<p>milestones </p>
<p>that </p>
<p>are </p>
<p>supported in the different versions of the component.  </p>
<p><b>Component Version </b></p>
<p><b>New Features </b></p>
<p>1.00.00 </p>
<p>Adaption to AUTOSAR Release 4 </p>
<p>1.02.00 </p>
<p>Support Variant Post-Build-Loadable </p>
<p>2.00.00 </p>
<p>Added Runtime Measurement Support </p>
<p>3.00.00 </p>
<p>Support Variant Post-Build-Selectable </p>
<p>Table 1-1  </p>
<p>Component history </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>11 </p>
<p>based on template version 5.2.0 </p>
<p><b>2. </b></p>
<p><b>Introduction </b></p>
<p>This document describes the functionality, API and configuration of the AUTOSAR BSW </p>
<p>module </p>
<p>CANNM </p>
<p>as </p>
<p>specified </p>
<p>in </p>
<p>[1] </p>
<p>and </p>
<p>[3]. </p>
<p>Also </p>
<p>the </p>
<p>integration </p>
<p>of </p>
<p>the </p>
<p>Network </p>
<p>Management into the AUTOSAR stack is covered by this document. </p>
<p>The  FlexRay  Network  Management,  LIN  Network  Management  and  the  UDP  Network </p>
<p>Management are not covered by this document. </p>
<p> </p>
<p>Please  note  that  in  this  document  the  term Application  is  not  used  strictly  for  the  user </p>
<p>software  but  also  for  any  higher  software  layer,  like  e.g.  the  Communication  Manager </p>
<p>(ComM). Therefore, Application refers to any of the software components using the CAN </p>
<p>NM. </p>
<p> </p>
<p>For further information please also refer to the AUTOSAR SWS specifications, referenced </p>
<p>at the beginning of this document in Table: ‘Reference Documents’. </p>
<p> </p>
<p><b>Supported AUTOSAR Release*: </b></p>
<p>4 </p>
<p><b>Supported Configuration Variants: </b></p>
<p>pre-compile, post-build-loadable, post-build-selectable </p>
<p><b>Vendor ID: </b></p>
<p>CANNM_VENDOR_ID </p>
<p>30 decimal </p>
<p>(= Vector-Informatik, </p>
<p>according to HIS) </p>
<p><b>Module ID: </b></p>
<p>CANNM_MODULE_ID   </p>
<p>31 decimal </p>
<p>(According to ref.[6]) </p>
<p>* For the precise AUTOSAR Release 4.x please see the release specific documentation.  </p>
<p> </p>
<p><b>2.1 </b></p>
<p><b>Naming Conventions </b></p>
<p>The  names  of  the  service  functions  provided  by  the  NM  Interface  and  CAN  NM  always </p>
<p>start with a prefix that denominates the module where the service is located. E.g. a service </p>
<p>that starts with ‘</p>
<p>CanNm_</p>
<p>’ is implemented within the CAN NM. </p>
<p> </p>
<p><b>Naming conventions </b></p>
<p>Nm_ </p>
<p>Services of NM Interface. </p>
<p>CanNm_ </p>
<p>Services of CAN NM. </p>
<p>Det_ </p>
<p>Services of Development Error Tracer. </p>
<p>Dem_ </p>
<p>Services of Diagnostic Event Manager. </p>
<p>Table 2-1  </p>
<p>Naming Conventions </p>
<p>Nodes  which  are  configured  to  be  passive  will  be  also  referred  to  as  passive  nodes. </p>
<p>Accordingly nodes that are not passive will be termed as active nodes. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>12 </p>
<p>based on template version 5.2.0 </p>
<p><b>2.2 </b></p>
<p><b>Architecture Overview </b></p>
<p>The following figure shows where the CANNM is located in the AUTOSAR architecture. </p>
<p> </p>
<p>Figure 2-1 </p>
<p>AUTOSAR 4.x Architecture Overview   </p>
<p><b>2.2.1 </b></p>
<p><b>Architecture of AUTOSAR Network Management </b></p>
<p>In  the  current  AUTOSAR  Release  the  standard  AUTOSAR  Network  Management  may </p>
<p>consist of up to five modules: </p>
<p><b>&gt; </b></p>
<p>NM Interface</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>CAN NM </p>
<p><b>&gt; </b></p>
<p>FlexRay NM</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>LIN NM</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>UDP NM</p>
<p>1</p>
<p> </p>
<p>The NM Interface schedules function calls from the application to the respective module </p>
<p>for  each  channel,  e.g.  for  a  CAN  channel  the  corresponding  CAN  NM  function  will  be </p>
<p>called. CAN NM exclusively interacts with the NM Interface. </p>
<p>The  communication  bus  specific  functionality  is  incorporated  in  the  corresponding  bus-</p>
<p>specific NM. The CAN-specific part implements the network management algorithm and is </p>
<p>                                            </p>
<p>1</p>
<p> Not covered by this document. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>13 </p>
<p>based on template version 5.2.0 </p>
<p>responsible for the transmission of NM messages on the communication bus by interacting </p>
<p>with the AUTOSAR CAN Interface. </p>
<p> </p>
<p>The  next  figure  shows  the  interfaces  to  adjacent  modules  of  the  CAN  NM.  These </p>
<p>interfaces are described in chapter 5 ‘API Description’. </p>
<p> </p>
<p>Figure 2-2 </p>
<p>Interfaces to adjacent modules of the CANNM </p>
<p>Applications do not access the services of the BSW modules directly. They use the service </p>
<p>ports provided by the BSW modules via the RTE. Since the CAN NM has no service ports, </p>
<p>the CAN NM cannot be accessed via RTE by the application. </p>
<p><b> cmp Interfaces</b></p>
<p><b>CanNm::CanNm</b></p>
<p><b>Nm::Nm</b></p>
<p><b>Det::Det</b></p>
<p><b>PduR::PduR</b></p>
<p><b>CanIf::CanIf</b></p>
<p><b>CanSM::CanSM</b></p>
<p><b>SchM::SchM</b></p>
<p>CanNm_Cbk</p>
<p>CanNm</p>
<p>CanIf</p>
<p>PduR_CanNm</p>
<p>Nm_Cbk</p>
<p>Det_ReportError</p>
<p>CanNm_ConfirmPnAvailability</p>
<p>SchM_CanNm</p>
<p>CanSM_TxTimeoutException</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>14 </p>
<p>based on template version 5.2.0 </p>
<p><b>3. </b></p>
<p><b>Functional Description </b></p>
<p><b>3.1 </b></p>
<p><b>Features </b></p>
<p>The Network Management is a network comprehensive protocol that provides services for </p>
<p>the organization of the network. It is a decentralized and direct network management. That </p>
<p>means  that  every  ECU  transmits  a  special  network  management  message,  which  is </p>
<p>reserved for the network management only. </p>
<p>The features listed in the following tables cover the complete functionality specified for the </p>
<p>CanNm. </p>
<p>The AUTOSAR  standard  functionality  is  specified  in  [3],  the  corresponding  features  are </p>
<p>listed in the tables </p>
<p><b>&gt; </b></p>
<p>Table 3-1   Supported AUTOSAR standard conform features </p>
<p><b>&gt; </b></p>
<p>Table 3-2   Not supported AUTOSAR standard conform features </p>
<p>Vector  Informatik  provides  further  CanNm  functionality  beyond  the AUTOSAR  standard. </p>
<p>The corresponding features are listed in the table </p>
<p><b>&gt; </b></p>
<p>Table 3-3   Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p>The following features specified in [3] are supported: </p>
<p><b>Supported AUTOSAR Standard Conform Features </b></p>
<p>Controlled transition of all ECU’s to bus-sleep mode and vice versa. </p>
<p>User Data Handling </p>
<p>Node Detection </p>
<p>Remote Sleep Indication </p>
<p>Coordinator Synchronization Support </p>
<p>Bus Synchronization </p>
<p>Bus Load Reduction </p>
<p>Immediate Tx Confirmation </p>
<p>Passive Mode Support </p>
<p>Immediate Restart </p>
<p>Pdu Rx Indication </p>
<p>State Change Indication </p>
<p>Repeat Message Indication </p>
<p>Com User Data Support </p>
<p>Active Wake-up Bit </p>
<p>Immediate Nm Transmissions </p>
<p>Car Wake-up </p>
<p>Partial Networking </p>
<p><b>Post-Build Loadable </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>15 </p>
<p>based on template version 5.2.0 </p>
<p><b>Supported AUTOSAR Standard Conform Features </b></p>
<p><b>MICROSAR Identity Manager using Post-Build Selectable </b></p>
<p>Table 3-1  </p>
<p>Supported AUTOSAR standard conform features </p>
<p><b>3.1.1 </b></p>
<p><b>Deviations Against AUTOSAR  </b></p>
<p>The following features specified in [3] are not supported: </p>
<p><b>Category </b></p>
<p><b>Description </b></p>
<p><b>ASR </b></p>
<p><b>Version </b></p>
<p>Functional </p>
<p>Communication Scheduling ch. 7.6: The CanNmMsgCycleOffset is </p>
<p>not applied when all NM messages have been transmitted with </p>
<p>CanNmImmediateNmCycleTime.[CANNM335] </p>
<p>4.0.3 </p>
<p>Functional </p>
<p>Initialization ch. 7.4. A call of CanNm_PassiveStartUp() in </p>
<p>PrepareBusSleep leads to a transition to Repeat Message state. </p>
<p>[CANNM147] </p>
<p>4.0.3 </p>
<p>Functional/Co</p>
<p>nfig </p>
<p>Error Notification ch. 7.16. CANNM_E_NETWORK_TIMEOUT is </p>
<p>only reported if configuration switch </p>
<p>CANNM_DISABLE_TX_ERROR_REPORT is </p>
<p>enabled[CANNM193][CANNM194] </p>
<p>&gt;4.0.3 </p>
<p>Functional </p>
<p>Debugging Concept ch. 7.18.3 Debugging is supported in </p>
<p>MICROSAR, but not as described in this chapter.[CANNM287]-</p>
<p>[CANNM290] </p>
<p>4.0.3 </p>
<p>Table 3-2  </p>
<p>Not supported AUTOSAR standard conform features </p>
<p><b>3.1.1.1 </b></p>
<p><b>RAM Initialization </b></p>
<p>If RAM is not implicitly initialized at start-up, the function </p>
<p>CanNm_InitMemory</p>
<p> has to be </p>
<p>called. </p>
<p><b>3.1.1.2 </b></p>
<p><b>Additional Configuration Dependencies </b></p>
<p>Following additional dependencies between configuration parameters are added to avoid </p>
<p>bad configurations:  </p>
<p><b>&gt; </b></p>
<p>Com Control Enabled must be disabled for passive nodes. </p>
<p><b>&gt; </b></p>
<p>Node Detection Enabled must be disabled for passive nodes. </p>
<p><b>3.1.1.3 </b></p>
<p><b>Variant Post-Build </b></p>
<p>Instead </p>
<p>of </p>
<p>the </p>
<p>Configuration </p>
<p>Variant </p>
<p>Post-Build, </p>
<p>the </p>
<p>Variant </p>
<p>Post-Build-Loadable </p>
<p>is </p>
<p>supported. </p>
<p><b>3.1.2 </b></p>
<p><b>Additions/ Extensions </b></p>
<p>The following extensions of the CAN NM software specifications ([3]) are available within </p>
<p>the  Network  Management  embedded  software  components.  If  required,  the  extensions </p>
<p>have to be enabled during configuration. </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>Single Channel Optimization </p>
<p>Memory Initialization </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>16 </p>
<p>based on template version 5.2.0 </p>
<p><b>Features Provided Beyond The AUTOSAR Standard </b></p>
<p>Disable Transmission Error Reporting </p>
<p>Calling CanNm_PassiveStartUp in Prepare Bus Sleep </p>
<p>Additional Development Error Codes </p>
<p>Variable DLC Support </p>
<p>Changeability of Additional Parameters During the Post-Build Phase </p>
<p>Runtime Measurement Support </p>
<p>Table 3-3  </p>
<p>Features provided beyond the AUTOSAR standard </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Some additional non-AUTOSAR features are only available if they are explicitly </p>
<p>ordered by the customer. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.1.2.1 </b></p>
<p><b>Single Channel Optimization </b></p>
<p>For single channel systems it is possible to optimize the source code for saving precious </p>
<p>resources  (ROM,  RAM  and  CPU  load).  This  optimization  is  only  possible  when  source </p>
<p>code is available. </p>
<p>Please </p>
<p>note </p>
<p>that </p>
<p>single </p>
<p>channel </p>
<p>optimization </p>
<p>can </p>
<p>only </p>
<p>be </p>
<p>enabled </p>
<p>in </p>
<p>pre-compile </p>
<p>configurations.  </p>
<p><b>3.1.2.2 </b></p>
<p><b>Memory Initialization </b></p>
<p>AUTOSAR  expects  the  startup  code  to  automatically  initialize  RAM.  Not  every  startup </p>
<p>code of embedded targets reinitializes all variables correctly it is possible that the state of </p>
<p>a variable may not be initialized, as expected. To avoid this problem the Vector AUTOSAR </p>
<p>NM provides additional functions to initialize the relevant variables of the CAN NM. </p>
<p>Refer also to chapter 5.3.1.3 ‘CanNm_InitMemory’. </p>
<p><b>3.1.2.3 </b></p>
<p><b>Disable Transmission Error Reporting </b></p>
<p>The error reporting for the following transmission errors can be disabled: </p>
<p><b>&gt; </b></p>
<p>CANNM_E_DEV_NETWORK_TIMEOUT </p>
<p><b>3.1.2.4 </b></p>
<p><b>Calling CanNm_PassiveStartUp in Prepare Bus Sleep </b></p>
<p>Calling CanNm_PassiveStartUp in Prepare Bus Sleep Mode has the same effects as if it </p>
<p>was called in Bus Sleep Mode. This has been done to support the Synchronous Wake-up </p>
<p>Feature in ComM. </p>
<p><b>3.1.2.5 </b></p>
<p><b>Additional Development Error Codes </b></p>
<p>There  are  additional  Development  Error  Codes  provided  as  Vector  extension.  Refer  to </p>
<p>chapter 3.12.1.1 for details. </p>
<p><b>3.1.2.6 </b></p>
<p><b>Variable DLC Support </b></p>
<p>CanNm supports multiple DLCs for CAN NM messages. Refer to chapter 3.6.5 for details. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>17 </p>
<p>based on template version 5.2.0 </p>
<p><b>3.1.2.7 </b></p>
<p><b>Changeability of Additional Parameters During the Post-Build Phase </b></p>
<p>In the Variant Post-Build-Loadable, the configuration parameters ‘Node Id’, ‘Rx Pdu Ref’, </p>
<p>‘Tx User Data Pdu Ref’, ‘Pn Filter Mask Byte Index’ and ‘Pn Filter Mask Byte Value’ are </p>
<p>also  changeable  during  the  post-build  phase  as  addition  to  the  post-build-changeable </p>
<p>parameters according to [3]. </p>
<p><b>3.1.3 </b></p>
<p><b>Limitations </b></p>
<p><b>3.1.3.1 </b></p>
<p><b>Ranges of Timers </b></p>
<p>The range for the following timer is limited concerning the specified range: </p>
<p><b>&gt; </b></p>
<p>Remote Sleep Indication Timer: 0.001..65.535 s (if remote sleep indication is enabled) </p>
<p>All timers should be multiples of the main functions cycle time. </p>
<p><b>3.1.3.2 </b></p>
<p><b>Effects of CanNm_DisableCommunication </b></p>
<p>If </p>
<p>CanNm_DisableCommunication</p>
<p> was called, CanNm_NetworkRelease has the same </p>
<p>effects as if </p>
<p>CanNm_DisableCommunication</p>
<p> was not called (contradicts to CANNM294 </p>
<p>of [3]). This was done to provide a more robust implementation. </p>
<p><b>3.1.3.3 </b></p>
<p><b>CANNM_E_NET_START_IND Development Error </b></p>
<p>The </p>
<p>CANNM_E_NET_START_IND</p>
<p> </p>
<p>development </p>
<p>error  code  (CANNM336  of </p>
<p>[3])  is  not </p>
<p>reported to the Det if an NM message has been received in Bus Sleep Mode. </p>
<p> </p>
<p>The following provides a detailed description of the functional scope. </p>
<p><b>3.2 </b></p>
<p><b>Network Management Mechanism </b></p>
<p>As  described  above  the AUTOSAR  NM  is  a  decentralized  direct  network  management. </p>
<p>This means that every network node has the same functionality and performs state and </p>
<p>operation  mode  changes  self-sufficient  depending  on  the  internal  state  and  whether </p>
<p>network management messages are still received. </p>
<p>The network management mechanism is quite simple: </p>
<p><b>&gt; </b></p>
<p>Every network node transmits its NM messages only as long as it needs to </p>
<p>communicate with other network nodes. Normally bus-communication is required as </p>
<p>long as clamp15 (ignition is turned on) is set or during follow-up. </p>
<p><b>&gt; </b></p>
<p>If there is no more network node in the whole network that need to communicate with </p>
<p>other network nodes, any node transmits no more NM messages. </p>
<p><b>&gt; </b></p>
<p>Each network node performs a transition to bus-sleep mode a certain time after the </p>
<p>last NM message has been transmitted by any node. Therefore all nodes will go to </p>
<p>bus-sleep mode together. </p>
<p><b>&gt; </b></p>
<p>If any network node requires bus-communication at any time it can wake up the whole </p>
<p>network by transmitting NM messages. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>18 </p>
<p>based on template version 5.2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The transmission of application messages, e.g. transmitted by the Com, does not stop </p>
<p>immediately after the last NM message has been transmitted. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>FAQ </b></p>
<p>The application is in charge of the decision whether the bus communication is required </p>
<p>or not. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>The following figure shows the state diagram of the CAN NM. The events are calls of CAN </p>
<p>NM functions by the application or data link layer or the timeout of internal timers. </p>
<p> </p>
<p>Figure 3-1 </p>
<p>State Diagram of CAN NM from SWS CAN NM [3] </p>
<p><b> stm State Machine</b></p>
<p><b>Network Mode</b></p>
<p><b>Bus-Sleep Mode</b></p>
<p><b>Prepare-Bus-Sleep Mode</b></p>
<p><b>Repeat Message</b></p>
<p><b>Ready Sleep</b></p>
<p><b>Normal Operation</b></p>
<p>Power On</p>
<p>Power Off</p>
<p>Repeat Message Timer</p>
<p>expires [Network requested]</p>
<p>NM Timeout Timer expires</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkTimeout</p>
<p>Network released</p>
<p>/Stop</p>
<p>Transmission of</p>
<p>NM</p>
<p>Repeat Message Request or</p>
<p>Repeat Msg Bit Indication</p>
<p>/Start Transmission of NM</p>
<p>Network requested</p>
<p>/Start</p>
<p>Transmission of</p>
<p>NM</p>
<p>Repeat Message Request or</p>
<p>Repeat Msg Bit Indication</p>
<p>/Start Transmission of NM</p>
<p>/Initialize NM</p>
<p>NM Timeout Timer expires</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkTimeout</p>
<p>Nm Message received or transmitted</p>
<p>/Restart NM Timeout Timer</p>
<p>Repeat Message Timer expires [Network released]</p>
<p>/Stop Transmission of NM</p>
<p>Wait Bus Sleep Timer expires</p>
<p>/Notify Nm_BusSleep Mode</p>
<p>Network requested/PassiveStartUp/Rx Nm Msg</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkMode</p>
<p>Start Transmission of NM messages</p>
<p>Can_TriggerTransmission (immediate restart +</p>
<p>Nw Req only)</p>
<p>Nm Msg received</p>
<p>/Notify NetworkStart</p>
<p>Indication</p>
<p>Network requested or</p>
<p>PassiveStartUp</p>
<p>/Start NM Timeout Timer</p>
<p>Notify NetworkMode</p>
<p>Start Transmission of NM</p>
<p>messages</p>
<p>NM Timeout Timer</p>
<p>expires</p>
<p>/Notify</p>
<p>PrepareBus-SleepMode</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>19 </p>
<p>based on template version 5.2.0 </p>
<p><b>3.3 </b></p>
<p><b>Initialization </b></p>
<p>Before the CAN NM can be used it has to be initialized by the application. The initialization </p>
<p>has to be carried out before any other functionality of the CAN NM is executed. It shall </p>
<p>take  place  after  initialization  of  the  CAN  Interface  and  prior  to  initialization  of  the  NM </p>
<p>Interface. </p>
<p>Also refer to chapter 5.3.1.1 ‘CanNm_Init: Initialization of CAN NM’. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The CAN NM assumes that some variables are initialized with zero at start-up. If the </p>
<p>embedded target does not initialize RAM within the start-up code the function </p>
<p>‘CanNm_InitMemory’ has to be called during start-up and before the initialization is </p>
<p>performed. Refer also to chapter 3.1.2.2 ‘Memory Initialization’. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In an AUTOSAR environment where the ECU Manager Fixed is used, the initialization </p>
<p>is performed within the ECU Manager. If the ECU Manager Flex is used, the </p>
<p>initialization is usually carried out by the BswM. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.4 </b></p>
<p><b>Passive Mode </b></p>
<p>Nodes in passive mode cannot transmit NM messages and therefore they do not actively </p>
<p>participate in the network. Due to that, passive nodes cannot request the network. </p>
<p>This  mode  can  be  used  for  nodes  that  do  not  need  to  keep  the  bus  awake  to  save </p>
<p>resources. </p>
<p>By  setting  'Repeat  Message  Time'  to  a  value  equal  to  0,  the  Repeat  Message  state  is </p>
<p>skipped. The state does not make sense for passive nodes, since the node is only able to </p>
<p>receive  NM  messages,  not  to  send  any.  Usually,  there  is  another  node  that  sends  NM </p>
<p>messages  in  Repeat  Message  so  there  is  no  need  for  'Repeat  Message  Time'  being </p>
<p>greater than 0 for passive nodes. </p>
<p>Nevertheless,  if  'Repeat  Message  Time'  is  configured  to  a  value  greater  than  0  and </p>
<p>‘Timeout Time’  is  greater  than  ‘Repeat  Message Time’ and  if  'Passive  Mode Enabled'  is </p>
<p>turned ON, the transition from Repeat Message to Prepare Bus Sleep only depends on the </p>
<p>reception of NM messages. If there is no recently received NM message, the transition to </p>
<p>Prepare Bus Sleep occurs after Timeout Time has elapsed. </p>
<p>In  case  ‘Repeat  Message  Time’  is  greater  than  ‘Timeout  Time’  and  no  NM  message  is </p>
<p>received  a  DET  error  will  occur  at  least  once  when  the  Timeout  Timer  elapses  within </p>
<p>Repeat Message State. The transition to Prepare Bus Sleep occurs  ‘Timeout Time’ after </p>
<p>the last DET error call. </p>
<p><b>3.5 </b></p>
<p><b>Operation Modes and States </b></p>
<p>The AUTOSAR NM consists of three operation modes: </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>20 </p>
<p>based on template version 5.2.0 </p>
<p><b>&gt; </b></p>
<p>Network Mode </p>
<p><b>&gt; </b></p>
<p>Prepare Bus-Sleep Mode </p>
<p><b>&gt; </b></p>
<p>Bus-Sleep Mode </p>
<p>The NM Interface is notified about changes of the operation mode by calling the following </p>
<p>functions: </p>
<p>Entering Bus-Sleep Mode: </p>
<p>Nm_BusSleepMode()</p>
<p> </p>
<p>(5.4) </p>
<p>Entering Network Mode: </p>
<p>Nm_NetworkMode()</p>
<p> </p>
<p>(5.4) </p>
<p>Leaving Network Mode: </p>
<p>Nm_PrepareBusSleepMode() </p>
<p>(</p>
<p>5.4) </p>
<p>Information about the current state and the current mode is provided by the service call </p>
<p>CanNm_GetState</p>
<p> (chapter 5.3.2.2). </p>
<p>The  CAN  NM  notifies  changes  of  the  current  state  to  the  NM  Interface  by  calling  the </p>
<p>optional function </p>
<p>Nm_StateChangeNotification() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p><b>3.5.1 </b></p>
<p><b>Network Mode </b></p>
<p>The Network Mode comprises three states: </p>
<p><b>&gt; </b></p>
<p>Repeat Message </p>
<p><b>&gt; </b></p>
<p>Normal Operation </p>
<p><b>&gt; </b></p>
<p>Ready Sleep </p>
<p>This  is  the  mode  in  that  the  ECU  is  ‘online’  and  participates  in  the  network.  The </p>
<p>participation in the network is active or passive depending on the state: </p>
<p><b>&gt; </b></p>
<p>Active participation: a node keeps the network awake (Repeat message State and </p>
<p>Normal Operation State). </p>
<p><b>&gt; </b></p>
<p>Passive participation: a node is ready for sleep (Ready Sleep State) and any other </p>
<p>node keeps the network alive. </p>
<p>The application is notified about entering the Network Mode by a call of the function: </p>
<p><b>Nm_NetworkMode</b>() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p>The  NM  Interface  notifies  leaving  the  Network  Mode  to  the  application  by  a  call  of  the </p>
<p>function: </p>
<p><b>Nm_PrepareBusSleepMode</b>() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>21 </p>
<p>based on template version 5.2.0 </p>
<p> </p>
<p><b>Info</b> </p>
<p>The Com is active during Network Mode. It is started upon entry and stopped upon exit </p>
<p>of Network Mode. I.e. application messages are transmitted and received within Network </p>
<p>Mode! </p>
<p><b>3.5.1.1  Repeat Message State </b></p>
<p>The Repeat Message State is entered: </p>
<p><b>&gt; </b></p>
<p>If a NM message has been received in Prepare Bus-Sleep Mode. </p>
<p><b>&gt; </b></p>
<p>If the network has been requested by a call of </p>
<p>CanNm_NetworkRequest()</p>
<p> in Bus-</p>
<p>Sleep or Prepare Bus-Sleep Mode. </p>
<p><b>&gt; </b></p>
<p>If the network is woken up from Bus-Sleep Mode or from Prepare Bus-Sleep Mode by </p>
<p>a call of </p>
<p>CanNm_PassiveStartUp()</p>
<p>. </p>
<p><b>&gt; </b></p>
<p>If any network node (including itself) has requested node detection in Ready Sleep or </p>
<p>Normal Operation State. </p>
<p>In Repeat Message State the NM messages are transmitted cyclically regardless whether </p>
<p>bus load reduction is enabled or disabled. </p>
<p>The Repeat Message State is left after a certain customizable time. </p>
<p>Depending on the bus-communication need of the application Normal Operation State or </p>
<p>Ready Sleep State is entered upon exit of Repeat Message State. </p>
<p><b>3.5.1.2  Normal Operation State </b></p>
<p>The network management stays in Normal Operation State until the bus-communication is </p>
<p>released.  The  local  bus-communication  request  of  the  application  is  distributed  in  the </p>
<p>network by the transmission of NM messages. </p>
<p><b>3.5.1.3  Ready Sleep State </b></p>
<p>The network management stays in Ready Sleep State as long as the application does not </p>
<p>request  bus-communication  and  the  application  of  any  other  node  still  requests  bus-</p>
<p>communication (by transmitting NM messages). </p>
<p>A certain customizable time after the last network node has released bus-communication a </p>
<p>transition to Prepare Bus-Sleep Mode is performed (i.e. Network Mode is left). </p>
<p><b>3.5.2 </b></p>
<p><b>Prepare Bus-Sleep Mode </b></p>
<p>The  transmission of  application messages  is stopped  when  entering  Prepare  Bus-Sleep </p>
<p>Mode.  The  bus  activity  is  calmed  down  (pending  message  are  still  transmitted)  in  this </p>
<p>mode and finally there is no more activity on the bus. </p>
<p>After the ‘wait bus sleep time’ the drop out of Prepare Bus-Sleep Mode to Bus-Sleep Mode </p>
<p>the NM Interface is notified by the service call: </p>
<p>Nm_BusSleepMode() </p>
<p>(</p>
<p>5.4)</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>22 </p>
<p>based on template version 5.2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>When entering Bus-Sleep Mode the physical bus interface has to be put into sleep </p>
<p>mode. </p>
<p>On CAN channels the transceiver and the CAN-Controller have to be put in sleep </p>
<p>mode. This information is forwarded by this callback to the ComM. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>If both NmOsek and CanNm are used on the same channel, CanNm is aware of the </p>
<p>prolonged shutdown of the NmOsek in case of a Limphome condition if the Wait Bus </p>
<p>Sleep Extensions feature is turned ON. For details see the following chapter 3.5.2.1. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>The Prepare Bus-Sleep Mode is left to Network Mode upon successful reception of a NM </p>
<p>message or if the network has been requested by a call of </p>
<p>CanNm_NetworkRequest()</p>
<p> </p>
<p>or if the network has been woken up by a call of </p>
<p>CanNm_PassiveStartUp()</p>
<p>. </p>
<p><b>3.5.2.1 </b></p>
<p><b>Wait Bus Sleep Extensions </b></p>
<p>If both NmOsek and CanNm are coordinated on the same channel, the internal state of </p>
<p>NmOsek influences the shutdown behavior of the CanNm. </p>
<p> </p>
<p><b>&gt; </b></p>
<p>NmOsek transitions from state NmNormal to NmWaitBusSleep </p>
<p>In this case the CanNm applies its normal shutdown time by using the CanNm’s “wait bus </p>
<p>sleep time”. </p>
<p><b>&gt; </b></p>
<p>NmOsek transitions from state NmLimpHome to NmWaitBusSleep </p>
<p>In  this case the  CanNm  applies a  longer shutdown  time  by  using “TErrorWaitBusSleep” </p>
<p>configured in NmOsek. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>This feature is automatically enabled when NmOsek and CanNm are configured </p>
<p>on  the  same  channel  and  “Wait  Bus  Sleep  Extensions”  feature  is  enabled  in </p>
<p>NmOsek. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>23 </p>
<p>based on template version 5.2.0 </p>
<p><b>3.5.3 </b></p>
<p><b>Bus-Sleep Mode </b></p>
<p>All network nodes perform a transition to bus-sleep mode at almost the same time, if no </p>
<p>NM message is lost and there hasn’t been a wake-up by any node. </p>
<p>The bus-sleep mode is left (wake-up) by a call of </p>
<p>CanNm_PassiveStartUp() </p>
<p>(5.3.2.3) </p>
<p>or if the network has been requested by a call of </p>
<p>CanNm_NetworkRequest() </p>
<p>(5.3.2.4.1) </p>
<p>In both cases Repeat Message State will be entered (see Chapter 3.5.1.1 ‘Repeat </p>
<p>Message State’). </p>
<p>If a NM message is received in Bus-Sleep Mode the service </p>
<p>Nm_NetworkStartIndication() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p>is called by CAN NM. </p>
<p><b>3.5.4 </b></p>
<p><b>Wake-up Registration </b></p>
<p>The </p>
<p>network </p>
<p>management </p>
<p>needs </p>
<p>to </p>
<p>know </p>
<p>whether </p>
<p>the </p>
<p>application </p>
<p>requires </p>
<p>bus </p>
<p>communication. Per default the network management does not actively participate in the </p>
<p>network. The active participation in the network is requested by the service </p>
<p>CanNm_NetworkRequest() </p>
<p> </p>
<p>(5.3.2.4.1) </p>
<p>Calling  this  function  in  Bus-Sleep  Mode  starts  the  network  and  leads  to  a  transition  to </p>
<p>Repeat Message State (see Chapter 3.5.3 ‘Bus-Sleep Mode’). </p>
<p>If bus communication is not required anymore it can be released with the service </p>
<p>CanNm_NetworkRelease() </p>
<p>(5.3.2.4.2) </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>When the communication control service is used the bus-communication shall not be </p>
<p>released as long as the NM message transmission ability is disabled. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Note that a bus-communication request is handled within the next task. Nevertheless it is </p>
<p>ensured that a communication request always leads to start-up even if the communication </p>
<p>is  released  before  the  next  task  is  executed.  Within  Network  Mode  a  fast  toggling  (i.e. </p>
<p>without  task  execution  in  between)  of  the  communication  status  does  not  lead  to  any </p>
<p>action. </p>
<p><b>3.5.5 </b></p>
<p><b>User Data Handling </b></p>
<p>The user data for the NM message transmitted next on the bus can be set by the service: </p>
<p>CanNm_SetUserData() </p>
<p>(5.3.2.5.1) </p>
<p>The service  </p>
<p>CanNm_GetUserData() </p>
<p>(5.3.2.5.2) </p>
<p>allows reading the user data of the last received message on the bus. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>24 </p>
<p>based on template version 5.2.0 </p>
<p>As the NM PDU layout is completely configurable, the user data placement depends on </p>
<p>the given configuration.  </p>
<p>The PDU layout and the content of the user data itself are OEM specific and therefore </p>
<p>provided by the OEM. </p>
<p>Note that for setting of NM user data a second possibility can be configured. Refer to </p>
<p>chapter 3.13 ‘Com User Data Support’ for more information. If the feature ‘Com User Data </p>
<p>Support’ is used the API </p>
<p>CanNm_SetUserData()</p>
<p> is not available. </p>
<p><b>3.6 </b></p>
<p><b>Network Management Message Transmission and Reception </b></p>
<p><b>3.6.1 </b></p>
<p><b>AUTOSAR CAN Interface </b></p>
<p>The  network  management  requests  the  transmission  of  NM  messages  by  calling  the </p>
<p>service </p>
<p>CanIf_Transmit</p>
<p>  [2].  The  application  has  to  take  care  of  the  user  data.  For </p>
<p>details refer to chapter 3.5.5 ‘User Data Handling’. </p>
<p>The successful transmission of every network management message is confirmed by the </p>
<p>CAN Interface with the service </p>
<p>CanNm_TxConfirmation() </p>
<p>(5.5.1.1) </p>
<p>The CAN Interface indicates the reception of NM message by calling the service  </p>
<p>CanNm_RxIndication() </p>
<p>(5.5.1.2) </p>
<p><b>3.6.2 </b></p>
<p><b>PDU Message Layout </b></p>
<p>The default PDU Message Layout is described in the following table: </p>
<p> </p>
<p>Bit 7 </p>
<p>Bit 6 </p>
<p>Bit 5 </p>
<p>Bit 4 </p>
<p>Bit 3 </p>
<p>Bit 2 </p>
<p>Bit 1 </p>
<p>Bit 0 </p>
<p>Byte 7 </p>
<p>User data 5 </p>
<p>Byte 6 </p>
<p>User data 4 </p>
<p>Byte 5 </p>
<p>User data 3 </p>
<p>Byte 4 </p>
<p>User data 2 </p>
<p>Byte 3 </p>
<p>User data 1 </p>
<p>Byte 2 </p>
<p>User data 0 </p>
<p>Byte 1 </p>
<p>Control Bit Vector </p>
<p>Byte 0 </p>
<p>Source Node Identifier </p>
<p>Table 3-4  </p>
<p>PDU NM Message Layout </p>
<p>The  number  of  User  Data  Bytes  as  well  as  the  positions  of  the  Control  Bit  Vector  and </p>
<p>Source Node Identifier can be configured arbitrarily but depend on the availability of the </p>
<p>corresponding features (User Data Support / Node Detection Enabled / Node Identifier).  </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>25 </p>
<p>based on template version 5.2.0 </p>
<p><b> </b></p>
<p><b>Bit 7 </b></p>
<p><b>Bit 6 </b></p>
<p><b>Bit 5 </b></p>
<p><b>Bit 4 </b></p>
<p><b>Bit 3 </b></p>
<p><b>Bit 2 </b></p>
<p><b>Bit 1 </b></p>
<p><b>Bit 0 </b></p>
<p><b>Byte 1 </b></p>
<p><b>(default) </b></p>
<p>Reserved </p>
<p>Cluster </p>
<p>Request </p>
<p>Information </p>
<p>Bit</p>
<p>2</p>
<p> </p>
<p>Reserved </p>
<p>Active </p>
<p>Wake-up </p>
<p>Bit </p>
<p>NM </p>
<p>Coordina</p>
<p>tor Sleep </p>
<p>Ready </p>
<p>Reserved </p>
<p>Reserved </p>
<p>Repeat </p>
<p>Message </p>
<p>Request </p>
<p>Table 3-5  </p>
<p>Control Bit Vector </p>
<p>The  Repeat  Message  Request  Bit  is  only  used  if  the  ‘Node  Detection’  feature  is active. </p>
<p>Refer to chapter 3.7 for more information. </p>
<p>The  NM  Coordinator  Sleep  Ready  Bit  is  only  used  if  the  ‘Coordinator  Synchronization </p>
<p>Support’ is active. See chapter 3.11 for more details. </p>
<p>The Active Wake-up Bit is used for the ‘Active Wake-up Handling’ (chapter 3.14). </p>
<p>The Cluster Request Information Bit is used for ‘Partial Networking’ (chapter 3.18). </p>
<p>All bits inside the Control Bit Vector are optionally used and depend on the setting of these </p>
<p>features. If the feature is not used, the bit value is 0. </p>
<p><b>3.6.3 </b></p>
<p><b>Message Transmissions </b></p>
<p>A standard sequence for NM message transmissions when Repeat Message is entered is </p>
<p>depicted in Figure 3-2. </p>
<p> </p>
<p>Figure 3-2 </p>
<p>Usual Behavior of NM Transmissions when Repeat Message is entered </p>
<p>The first NM message is transmitted when ‘Msg Cycle Offset’ ms has been elapsed after </p>
<p>Repeat Message has been entered. The next NM message will be transmitted after Msg </p>
<p>Cycle Time has been elapsed. The configuration settings that influence this behavior are: </p>
<p><b>&gt; </b></p>
<p>‘Msg Cycle Offset’: time before the transmission of the first NM message </p>
<p><b>&gt; </b></p>
<p>‘Msg Cycle Time’: time between each message transmission </p>
<p><b>&gt; </b></p>
<p>‘Immediate Restart Enabled’: if enabled, an additional NM message will be sent </p>
<p>immediately upon an active request (CanNm_NetworkRequest was called) from </p>
<p>Prepare Bus Sleep to Repeat Message (see also chapter 3.16) in case ‘Msg Cycle </p>
<p>Offset’ is greater than zero </p>
<p>                                            </p>
<p>2</p>
<p> This bit is also called ‘Partial Network Information Bit’ </p>
<p>t</p>
<p>Bus Sleep or</p>
<p>Prepare Bus Sleep</p>
<p>Msg Cycle Offset</p>
<p>Msg Cycle Time</p>
<p>Msg Cycle Time</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Usual behavior without immediate transmissions</p>
<p>0</p>
<p>Repeat Message</p>
<p>CanNm_PassiveStartUp or</p>
<p>CanNm_NetworkRequest</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>26 </p>
<p>based on template version 5.2.0 </p>
<p><b>&gt; </b></p>
<p>‘Immediate Nm Transmissions’: if this setting is greater than zero, an immediate NM </p>
<p>message will be sent when Repeat Message is entered due to an active request. The </p>
<p>interval between NM messages will be different for the next (‘Immediate Nm </p>
<p>Transmissions’ - 1) NM messages to be sent. Refer to chapter 3.15 for more details. </p>
<p><b>&gt; </b></p>
<p>‘Repeat Message Time’: this setting determines for how long CanNm shall keep the </p>
<p>Repeat Message state. If the node has been requested passively, the next state will be </p>
<p>Ready Sleep. </p>
<p>Note that the NM message is sent as long as the NM state is ‘Repeat Message’ or ‘Normal </p>
<p>Operation’. For details about these states, see also chapter 3.5.1. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The lower layer (e.g. CAN Interface) may reject the send request if Network Mode has </p>
<p>just been entered. </p>
<p>CanNm usually does not retry to issue the send request of the NM message. There are </p>
<p>features, which may enable retries in certain conditions: </p>
<p>If ‘Immediate Nm Transmissions’ are greater than zero, the rejected send request is not </p>
<p>considered as ‘Immediate Transmission’ (see chapter 3.15). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p><b>3.6.4 </b></p>
<p><b>Bus Load Reduction </b></p>
<p>The bus load reduction is started automatically if enabled and when Normal Operation </p>
<p>state is entered. When Normal Operation state is left, bus load reduction algorithm is </p>
<p>stopped. For more information refer to chapter 7.7 of [3]. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Bus Load Reduction cannot be used on the channel if Partial Networking is used on the </p>
<p>same channel and vice versa. However setups like Bus Load Reduction is active on </p>
<p>the one channel and Partial Networking is active on the other channel is allowed. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.6.5 </b></p>
<p><b>Support for RX PDUs with Different Lengths </b></p>
<p>The  CAN  NM  supports  messages  with  different  lengths  (DLCs).  This  support  can  be </p>
<p>enabled </p>
<p>by </p>
<p>disabling </p>
<p>the </p>
<p>‘CanIf </p>
<p>Range </p>
<p>Config </p>
<p>DLC </p>
<p>Check’ </p>
<p>setting </p>
<p>in </p>
<p>the </p>
<p>module </p>
<p>configuration. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>27 </p>
<p>based on template version 5.2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The setting is enabled, if a macro definition of </p>
<p>CANNM_CANIF_RANGE_CONFIG_DLC_CHECK can be found in CanNm_Cfg.h. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>In  case  the  ‘CanIf  Range  Config  DLC  Check’  setting  is  disabled,  it  is assumed  that  the </p>
<p>CanIf  module  accepts  NM  messages  with  different  DLCs.  The  minimum  DLC  for  NM </p>
<p>messages  may  be  configured  in  the  CanIf module,  messages  with  a  DLC  less  than  the </p>
<p>configured value for the DLC check will be discarded. Messages with the same DLC or </p>
<p>greater DLC will be received and forwarded to CanNm. </p>
<p>However, the maximum number of bytes that is evaluated from the received message is </p>
<p>equal  to  the  ‘Pdu  Length’  setting  of  the  corresponding  channel.  For  messages  with  a </p>
<p>length <i>n </i> smaller than ‘Pdu Length’,  the  bytes <i> n </i> …  (‘Pdu Length’  -  1) are  considered  as </p>
<p>being zero. </p>
<p>Examples: </p>
<p>The length of a received message is 8, ‘Pdu Length’ is configured to 6. In this case, the </p>
<p>last two user data bytes are not further processed by CanNm (e.g. CanNm_GetUserData </p>
<p>does not return data for these two bytes). </p>
<p>The length of a received message is 4, ‘Pdu Length’ is configured to 6. In this case, bytes </p>
<p>4  and  5  are  considered  as  being  zero  (e.g.  CanNm_GetUserData  returns  0  for  these </p>
<p>bytes). </p>
<p>The  minimum  required  number  of  bytes  for  a  received  NM  message  that  should  be </p>
<p>processed by CanNm may be configured by using the CanIf DLC Check feature [2]. </p>
<p>If  the  ‘CanIf  Range  Config  DLC  Check’  setting  is  enabled,  either the  CanIf  DLC feature </p>
<p>must be enabled to accept only NM messages  with a DLC greater than or equal to the </p>
<p>‘Pdu Length’ setting or there must not be any ECU that sends NM messages with a DLC </p>
<p>less than the ‘Pdu Length’ setting. Otherwise, the behavior of the CanNm will be arbitrary. </p>
<p><b>3.7 </b></p>
<p><b>Node Detection </b></p>
<p>In order to detect which nodes are currently present within the network, this mechanism </p>
<p>can be used. If a network node requests node detection, the requesting node performs a </p>
<p>transition to Repeat Message State and sets the Repeat Message Bit within the NM PDU. </p>
<p>Upon  reception  of  the  Repeat  Message  Bit  all  network  nodes  perform  a  transition  to </p>
<p>Repeat  Message  State.  This  allows  the  requesting  node  to  collect  all  source  node </p>
<p>identifiers from active nodes. </p>
<p>The local source node identifier can be retrieved by the service </p>
<p>CanNm_GetLocalNodeIdentifier() </p>
<p>(5.3.2.6.3) </p>
<p>The source node identifier from the last received message can be retrieved by the service </p>
<p>CanNm_GetNodeIdentifier() </p>
<p>(5.3.2.6.2) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>28 </p>
<p>based on template version 5.2.0 </p>
<p><b>3.8 </b></p>
<p><b>NM PDU Receive Indication </b></p>
<p>The  NM  Interface  is  notified  about  the  reception  of  an  NM  message  by  the  optional </p>
<p>function </p>
<p>Nm_PduRxIndication()</p>
<p> </p>
<p>(5.4) </p>
<p>In  case  more  than  one  BusNm  is  configured  on  the  same  channel,  a  BusNm  specific </p>
<p>reception notification is called. </p>
<p>Nm_CanNm_PduRxIndication() </p>
<p>(5.4) </p>
<p>The CAN NM notifies the callback directly to the NM Interface in context of the function </p>
<p>CanNm_RxIndication</p>
<p> (see chapter 5.5.1.2). </p>
<p><b>3.9 </b></p>
<p><b>Communication Control </b></p>
<p>In </p>
<p>order </p>
<p>to </p>
<p>support </p>
<p>ISO </p>
<p>14229 </p>
<p>Communication </p>
<p>Control </p>
<p>Service </p>
<p>$28 </p>
<p>the </p>
<p>network </p>
<p>management  has  a  message  transmission  control  status,  which  allows  disabling  the </p>
<p>transmission  of  NM  messages  while  bus-communication  is  requested.  Therefore  the </p>
<p>function </p>
<p>CanNm_DisableCommunication()</p>
<p> </p>
<p>(5.3.2.10.1) </p>
<p>can be called. The transmission of NM messages will be stopped within the next CAN NM </p>
<p>main function call. </p>
<p>The NM PDU transmission ability is enabled again by the service </p>
<p>CanNm_EnableCommunication()</p>
<p> </p>
<p>(5.3.2.10.2) </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>An ECU shall not shut down if the NM PDU transmission ability is disabled. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.10 </b></p>
<p><b>Gateway Functionality </b></p>
<p><b>3.10.1 </b></p>
<p><b>Remote Sleep Indication and Cancellation </b></p>
<p>In  order  to  synchronize  networks  it  might  be  necessary  to  get  an  indication  whether  no </p>
<p>more  network  nodes  require  bus-communication.  This  is  the  so-called  ‘Remote  Sleep </p>
<p>Indication’. The start of the remote sleep indication is indicated by </p>
<p>Nm_RemoteSleepIndication() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p>If any NM message is received during Normal Operation State or Ready Sleep State after </p>
<p>the remote sleep indication the service ‘Remote Sleep Cancellation’ is called: </p>
<p>Nm_RemoteSleepCancellation() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p>It is also possible to retrieve the current remote sleep state by calling the service: </p>
<p>CanNm_CheckRemoteSleepIndication() </p>
<p>(5.3.2.8.1) </p>
<p>Remote sleep indication can only be checked in Ready Sleep state and Normal Operation </p>
<p>state. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>29 </p>
<p>based on template version 5.2.0 </p>
<p><b>3.10.2 </b></p>
<p><b>Bus Synchronization </b></p>
<p>In  order to  synchronize  networks for a  synchronized  shutdown  it  might  be  necessary  to </p>
<p>transmit an asynchronous NM message to reset the network timers. This can be done by </p>
<p>calling the service:  </p>
<p>CanNm_RequestBusSynchronization() </p>
<p>(5.3.2.7.1) </p>
<p>However this service shall only be called within Network Mode. </p>
<p><b>3.11 </b></p>
<p><b>Coordinator Synchronization Support </b></p>
<p>For </p>
<p>supporting </p>
<p>the </p>
<p>NM </p>
<p>Interface </p>
<p>Coordinator </p>
<p>Synchronization </p>
<p>with </p>
<p>more </p>
<p>than </p>
<p>one </p>
<p>coordinator connected to the same channel it is necessary to provide one additional bit in </p>
<p>the CBV. Therefore the service call </p>
<p>CanNm_SetSleepReadyBit() </p>
<p>(5.3.2.11.1) </p>
<p>allows to set and clear the Nm Coordinator Sleep Ready Bit (see chapter 3.6.2 for further </p>
<p>information). Each call of this API triggers the immediate transmission of an NM message </p>
<p>can be sent according to the current state in the CanNm State Machine (see Figure 3-1) in </p>
<p>order to propagate the change of the Sleep Ready Bit as soon as possible. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>The ‘Coordinator Synchronization Support’ requires the Control Bit Vector. </p>
<p>Therefore this feature has to be enabled if the Coordination Synchronization Support is </p>
<p>used. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.12 </b></p>
<p><b>Error Handling </b></p>
<p><b>3.12.1 </b></p>
<p><b>Development Error Detection </b></p>
<p>By </p>
<p>default, </p>
<p>development </p>
<p>errors </p>
<p>are </p>
<p>reported </p>
<p>to </p>
<p>the </p>
<p>DET </p>
<p>using </p>
<p>the </p>
<p>service </p>
<p>Det_ReportError()</p>
<p>  as  specified  in  [5],  if development  error reporting  is  enabled  (i.e. </p>
<p>pre-compile parameter </p>
<p>CANNM_DEV_ERROR_DETECT==STD_ON</p>
<p>). </p>
<p>If  another  module  is  used  for  development  error  reporting,  the  function  prototype  for </p>
<p>reporting the error can be configured by the integrator, but must have the same signature </p>
<p>as the service </p>
<p>Det_ReportError()</p>
<p>. </p>
<p>The reported CANNM ID is 31. </p>
<p>The  reported  service  IDs  identify  the  services  which  are  described  in  5.3  and  5.5.  The </p>
<p>following table presents the service IDs and the related services: </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x00 </p>
<p>CanNm_Init </p>
<p>0x01 </p>
<p>CanNm_PassiveStartUp </p>
<p>0x02 </p>
<p>CanNm_NetworkRequest </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>30 </p>
<p>based on template version 5.2.0 </p>
<p><b>Service ID </b></p>
<p><b>Service </b></p>
<p>0x03 </p>
<p>CanNm_NetworkRelease </p>
<p>0x04 </p>
<p>CanNm_SetUserData </p>
<p>0x05 </p>
<p>CanNm_GetUserData </p>
<p>0x06 </p>
<p>CanNm_GetNodeIdentifier </p>
<p>0x07 </p>
<p>CanNm_GetLocalNodeIdentifier </p>
<p>0x08 </p>
<p>CanNm_RepeatMessageRequest </p>
<p>0x0A </p>
<p>CanNm_GetPduData </p>
<p>0x0B </p>
<p>CanNm_GetState </p>
<p>0x0C </p>
<p>CanNm_DisableCommunication </p>
<p>0x0D </p>
<p>CanNm_EnableCommunication </p>
<p>0x13 </p>
<p>CanNm_MainFunction </p>
<p>0x14 </p>
<p>CanNm_Transmit </p>
<p>0x16 </p>
<p>CanNm_ConfirmPnAvailability </p>
<p>0x17 </p>
<p>CanNm_SetSleepReadyBit </p>
<p>0x40 </p>
<p>CanNm_TxConfirmation </p>
<p>0x42 </p>
<p>CanNm_RxIndication </p>
<p>0xC0 </p>
<p>CanNm_RequestBusSynchronization </p>
<p>0xD0 </p>
<p>CanNm_CheckRemoteSleepIndication </p>
<p>0xF1 </p>
<p>CanNm_GetVersionInfo </p>
<p>Table 3-6  </p>
<p>Service IDs </p>
<p><b>3.12.1.1 </b></p>
<p><b>Det_ReportError </b></p>
<p>Development errors are reported by the service </p>
<p>Det_ReportError() </p>
<p>(5.4) </p>
<p>Please </p>
<p>refer </p>
<p>to </p>
<p>the </p>
<p>documentation </p>
<p>of </p>
<p>the </p>
<p>development </p>
<p>error </p>
<p>tracer </p>
<p>[5] </p>
<p>for </p>
<p>further </p>
<p>information and a detailed description of the API. The module Id, API Ids and error Ids can </p>
<p>be found within the software components’ header file. </p>
<p>The errors reported to DET are described in the following table: </p>
<p><b>Error </b></p>
<p><b>Code </b></p>
<p><b>Description </b></p>
<p>0x01 </p>
<p>CANNM_E_NO_INIT </p>
<p>API service used without module initialization. </p>
<p>0x02 </p>
<p>CANNM_E_INVALID_CHANNEL </p>
<p>API service used with wrong channel handle. </p>
<p>0x03 </p>
<p>CANNM_E_INVALID_PDUID </p>
<p>API service used with wrong PDU ID </p>
<p>0x04 </p>
<p>CANNM_E_NET_START_IND </p>
<p>Reception of NM Message in Bus Sleep Mode </p>
<p>0x05 </p>
<p>CANNM_E_INIT_FAILED </p>
<p>CAN NM initialization has failed. </p>
<p>0x11 </p>
<p>CANNM_E_NETWORK_TIMEOUT </p>
<p>NM-Timeout Timer has abnormally expired </p>
<p>outside of the Ready Sleep State. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>31 </p>
<p>based on template version 5.2.0 </p>
<p><b>Error </b></p>
<p><b>Code </b></p>
<p><b>Description </b></p>
<p>0x12 </p>
<p>CANNM_E_PARAM_POINTER</p>
<p>3</p>
<p> </p>
<p>Null pointer has been passed as an argument. </p>
<p>0x20 </p>
<p>CANNM_E_RXINDICATION_DLC_ERROR</p>
<p>4</p>
<p> </p>
<p>DLC of received NM message does not match </p>
<p>with configured PDU Length. </p>
<p>0x21 </p>
<p>CANNM_E_PDUR_TRIGGERTX_ERROR</p>
<p>4</p>
<p> </p>
<p>Call of function PduR_TriggerTransmit failed.</p>
<p> </p>
<p>0x22 </p>
<p>CANNM_E_ALREADY_INITIALIZED </p>
<p>CAN NM initialization done more than once. </p>
<p>0x33 </p>
<p>CANNM_E_INVALID_GENDATA </p>
<p>Invalid write access due to wrong </p>
<p>configuration data. </p>
<p>Table 3-7  </p>
<p>Errors reported to DET </p>
<p><b>3.12.1.2  Parameter Checking </b></p>
<p>AUTOSAR requires that API functions check the validity of their parameters. The checks in </p>
<p>Table  3-8  are  internal  parameter  checks  of  the  API  functions.  These  checks  are  for </p>
<p>development error reporting. The error reporting of </p>
<p>CANNM_E_NETWORK_TIMEOUT</p>
<p> can be </p>
<p>en-/disabled separately by the configuration switch ‘Disable Tx Err Report’. The Parameter </p>
<p>CANNM_DEV_ERROR_DETECT</p>
<p>  dis-/  enables  the  call  of  Det_ReportError()  for  all  checks </p>
<p>globally. </p>
<p>The following table shows which parameter checks are performed on which services: </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>CANNM_E_NO_INIT</p>
<p> </p>
<p>CANNM_E_INVALID_CHANNEL</p>
<p> </p>
<p>CANNM_E_NULL_POINTER</p>
<p> </p>
<p>CANNM_E_INVALID_PDUID </p>
<p>CANNM_E_NET_START_IND</p>
<p> </p>
<p>CANNM_E_INIT_FAILED</p>
<p> </p>
<p>CANNM_E_NETWORK_TIMEOUT</p>
<p> </p>
<p>CANNM_E_RXINDICATION_DLC_</p>
<p>ERROR</p>
<p> </p>
<p>CANNM_E_PDUR_TRIGGERTX_ER</p>
<p>ROR</p>
<p> </p>
<p>CanNm_Init </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>5</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_PassiveStartUp </p>
<p></p>
<p> </p>
<p></p>
<p>6</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_NetworkRequest </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_NetworkRelease </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_SetUserData </p>
<p></p>
<p>7</p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p>7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_GetUserData </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_GetPduData </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_RepeatMessageRequest </p>
<p></p>
<p>5,7</p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_GetNodeIdentifier </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_GetLocalNodeIdentifier </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>                                            </p>
<p>3</p>
<p> Error does not apply to the function </p>
<p>CanNm_Init</p>
<p>. </p>
<p>4</p>
<p> Vector extension </p>
<p>5</p>
<p> Only checked if CANNM_DEV_ERROR_DETECT is STD_ON </p>
<p>6</p>
<p> Only checked if CANNM_OPTIMIZE_CHANNEL_ENABLED is not defined (‘Api Optimization’ is OFF) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>32 </p>
<p>based on template version 5.2.0 </p>
<p><b>Check </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>Service </b></p>
<p>CANNM_E_NO_INIT</p>
<p> </p>
<p>CANNM_E_INVALID_CHANNEL</p>
<p> </p>
<p>CANNM_E_NULL_POINTER</p>
<p> </p>
<p>CANNM_E_INVALID_PDUID </p>
<p>CANNM_E_NET_START_IND</p>
<p> </p>
<p>CANNM_E_INIT_FAILED</p>
<p> </p>
<p>CANNM_E_NETWORK_TIMEOUT</p>
<p> </p>
<p>CANNM_E_RXINDICATION_DLC_</p>
<p>ERROR</p>
<p> </p>
<p>CANNM_E_PDUR_TRIGGERTX_ER</p>
<p>ROR</p>
<p> </p>
<p>CanNm_RequestBusSynchronization </p>
<p></p>
<p>7</p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_CheckRemoteSleepIndication </p>
<p></p>
<p>7</p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p>7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_GetState </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_GetVersionInfo </p>
<p> </p>
<p> </p>
<p></p>
<p>5</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_Transmit </p>
<p></p>
<p>7</p>
<p> </p>
<p> </p>
<p></p>
<p>7</p>
<p> </p>
<p></p>
<p>5,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_EnableCommunication </p>
<p></p>
<p>7</p>
<p> </p>
<p></p>
<p>6,7,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_DisableCommunication </p>
<p></p>
<p>7</p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_ConfirmPnAvailability </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_SetSleepReadyBit </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>CanNm_RxIndication </p>
<p></p>
<p> </p>
<p> </p>
<p></p>
<p> </p>
<p></p>
<p>5</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>5</p>
<p> </p>
<p> </p>
<p>CanNm_MainFunction </p>
<p></p>
<p> </p>
<p></p>
<p>6,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>5</p>
<p> </p>
<p> </p>
<p></p>
<p>5</p>
<p> </p>
<p>CanNm_TxConfirmation </p>
<p></p>
<p>7</p>
<p> </p>
<p> </p>
<p> </p>
<p></p>
<p>5,7</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Table 3-8  </p>
<p>Development Error Reporting: Assignment of checks to services </p>
<p><b>3.12.2 </b></p>
<p><b>Production Code Error Reporting </b></p>
<p>By  default,  production  code  related  errors  are  reported  to  the  DEM  using  the  service </p>
<p>Dem_ReportErrorStatus()</p>
<p> as specified in [4], if production error reporting is enabled. </p>
<p>If another module  is used for production  code  error reporting,  the  function  prototype for </p>
<p>reporting the error can be configured by the integrator, but must have the same signature </p>
<p>as the service </p>
<p>Dem_ReportErrorStatus()</p>
<p>. </p>
<p>The errors reported to DEM are described in the following table: </p>
<p><b>Error Code </b></p>
<p><b>Description </b></p>
<p>N/A </p>
<p>Currently no DEM errors are specified </p>
<p>Table 3-9  </p>
<p>Errors reported to DEM </p>
<p><b>3.13 </b></p>
<p><b>Com User Data Support </b></p>
<p>The CAN NM supports the possibility to write the NM user data via Com signals. Therefore </p>
<p>the signals have to be provided within an additional I-PDU in the configuration. The CAN </p>
<p>                                            </p>
<p>7</p>
<p> Only checked if CANNM_PASSIVE_MODE_ENABLED is STD_OFF </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>33 </p>
<p>based on template version 5.2.0 </p>
<p>NM  updates  its  transmission  buffer  each  time  before  sending  a  NM  message  with  the </p>
<p>current data. Therefore it calls the function: </p>
<p>PduR_CanNmTriggerTransmit() </p>
<p>(5.4) </p>
<p>When the NM message has been successfully transmitted the confirmation is forwarded to </p>
<p>PduR by calling the function: </p>
<p>PduR_CanNmTxConfirmation() </p>
<p>(5.4) </p>
<p>Depending on the signal and I-PDU configuration a signal change can lead to a request for </p>
<p>an immediate NM message transmission by calling the function </p>
<p>CanNm_Transmit() </p>
<p>(5.3.2.9.1) </p>
<p>The  CAN  NM  then  transmits  the  changed  data  in  the  next  main  function  when  the </p>
<p>transmission of NM messages is allowed. Afterwards the message cycle timer is restarted, </p>
<p>i.e. the cyclic message transmission raster changes. </p>
<p>The  spontaneous  transmission  through  CanNm_Transmit  is  allowed  in  the  NM  states </p>
<p>Repeat Message and Normal Operation if and only if </p>
<p><b>&gt; </b></p>
<p>‘Pn Enabled’ is ON and ‘Pn Handle Multiple Network Requests’ is OFF AND/OR </p>
<p><b>&gt; </b></p>
<p>‘Car Wake Up Rx Enabled’ is ON. </p>
<p> </p>
<p>Figure 3-3 </p>
<p>Immediate Transmission due to Signal Change inside User Data I-PDU </p>
<p>The  following  chapters  describe  more  detailed  the  configuration  preconditions  of  this </p>
<p>feature. </p>
<p>Note that some additional configuration for this feature has to be done in the PDU Router. </p>
<p>Refer to [10] for details. </p>
<p><b>3.13.1 </b></p>
<p><b>Configuration Preconditions in an AUTOSAR ECU Configuration </b></p>
<p>For  using  the  feature  ‘Com  User  Data  Support’  some  additional  configuration  content </p>
<p>within the AUTOSAR system description / ECU Extract is necessary. The following table </p>
<p>provides an overview of the items that have to be added to the system description. </p>
<p><b>Configuration Element </b></p>
<p><b>Description </b></p>
<p>Signal I-PDU </p>
<p>For each NM message one signal I-PDU must be configured. An </p>
<p>appropriate signal mapping to the I-Signals has to be defined here. I-</p>
<p>PDUs are defined in the ECU-specific part. </p>
<p>t</p>
<p>Msg Cycle Offset</p>
<p>Msg Cycle Time</p>
<p>Msg Cycle Time</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Behavior with CanNm_Transmit usage</p>
<p>0</p>
<p>Repeat Message</p>
<p>Normal Operation</p>
<p>...</p>
<p>CanNm_Transmit</p>
<p>Msg Cycle Time</p>
<p>CanNm_Transmit</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>34 </p>
<p>based on template version 5.2.0 </p>
<p><b>Configuration Element </b></p>
<p><b>Description </b></p>
<p>I-Signal </p>
<p>Multiple system signals can be defined for each NM message. At </p>
<p>least one signal is required. I-Signals are defined in the ECU-specific </p>
<p>part and refer to a system signal. </p>
<p>System Signal </p>
<p>For each I-Signal a corresponding system signal is necessary which </p>
<p>defines length, data type and init value. </p>
<p>I-PDU Port </p>
<p>For each I-PDU an I-PDU port with the communication direction </p>
<p>‘OUT’ is required. </p>
<p>Signal Port </p>
<p>For each signal a signal port with the communication direction ‘OUT’ </p>
<p>is required. </p>
<p>I-PDU Triggering </p>
<p>For each I-PDU an I-PDU triggering is required that references to the </p>
<p>corresponding I-PDU port and the signal I-PDU. </p>
<p>Signal Triggering </p>
<p>For each I-Signal a signal triggering is required that references to the </p>
<p>corresponding signal port and I-Signal. </p>
<p>Table 3-10  </p>
<p>Configuration Precondition Overview for AUTOSAR ECU Configurations </p>
<p>Additionally, a reference from the NM PDU to the related I-PDU with the signals must be </p>
<p>established  by  adding  ‘ISignalToIPduMappings’  to  the  NM  PDU.  The  following  example </p>
<p>demonstrates how this should be done: </p>
<p>&lt;NM-PDU&gt; </p>
<p> </p>
<p>&lt;SHORT-NAME&gt;NM_PDU&lt;/SHORT-NAME&gt; </p>
<p> </p>
<p>&lt;LENGTH&gt;8&lt;/LENGTH&gt; </p>
<p> </p>
<p>&lt;I-SIGNAL-TO-I-PDU-MAPPINGS&gt; </p>
<p> </p>
<p> </p>
<p>&lt;I-SIGNAL-TO-I-PDU-MAPPING&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p>&lt;SHORT-NAME&gt;NM_USR_DT &lt;/SHORT-NAME&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p>&lt;I-SIGNAL-REF DEST=&quot;I-</p>
<p>SIGNAL&quot;&gt;/ISignal/NM_USR_DT_SIGNAL&lt;/I-SIGNAL-REF&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p>&lt;PACKING-BYTE-ORDER&gt;MOST-SIGNIFICANT-BYTE-LAST&lt;/PACKING-</p>
<p>BYTE-ORDER&gt; </p>
<p> </p>
<p> </p>
<p> </p>
<p>&lt;START-POSITION&gt;32&lt;/START-POSITION&gt; </p>
<p> </p>
<p> </p>
<p>&lt;/I-SIGNAL-TO-I-PDU-MAPPING&gt; </p>
<p> </p>
<p>&lt;/I-SIGNAL-TO-I-PDU-MAPPINGS&gt; </p>
<p>&lt;/NM-PDU&gt; </p>
<p><b>3.14 </b></p>
<p><b>Active Wake-up Handling </b></p>
<p>The mode  change from Bus-Sleep  Mode  or  Prepare Bus-Sleep Mode to  Network Mode </p>
<p>triggered by CanNm_NetworkRequest() is specified as “Active Wake-up”. Upon an Active </p>
<p>Wake-up  the  CAN  NM  sets  the  active  wake-up  bit  within  the  Control  Bit  Vector  at  bit </p>
<p>position 4. </p>
<p>This feature is optional and has to be configured. </p>
<p><b>3.15 </b></p>
<p><b>Immediate Nm Transmissions </b></p>
<p>If an Active Wake-up occurs the CAN NM transmits the first NM message immediately (the </p>
<p>NM message offset time is ignored) when entering Repeat Message State. For the next </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>35 </p>
<p>based on template version 5.2.0 </p>
<p>NM  messages  CAN  NM  uses  a  faster  NM  message  cycle  time. Afterwards  it  uses  the </p>
<p>normal NM message cycle time. This behavior is illustrated in Figure 3-4. </p>
<p> </p>
<p>Figure 3-4 </p>
<p>Immediate Nm Transmissions </p>
<p>The  number  of  ‘Immediate  Nm  Transmissions’  is  the  number  that  is  configured  for  this </p>
<p>parameter. As it can be seen in Figure 3-4, after the first Immediate Nm Transmission the </p>
<p>interval between the NM messages is ‘Immediate Nm CycleTime’ for <i>(n-1) </i>times. Then, the </p>
<p>usual interval ‘Msg Cycle Time’ is used again. </p>
<p>Note  that  “Any  state  except  Repeat  Message”  in  Figure  3-4  refers  to  ‘Bus  Sleep’  and </p>
<p>‘Prepare Bus Sleep’. If the setting ‘Pn Handle Multiple Network Requests’ is ON, it also </p>
<p>refers to ‘Ready Sleep’ and ‘Normal Operation’. </p>
<p>This  feature  is  optional  and  has  to  be  enabled  in  the  configuration.  The  amount  of </p>
<p>messages </p>
<p>that </p>
<p>are </p>
<p>transmitted </p>
<p>faster </p>
<p>(‘Immediate </p>
<p>Nm  Transmissions’) </p>
<p>and </p>
<p>the </p>
<p>fast </p>
<p>message cycle time (‘Immediate Nm Cycle Time’) can also be configured. </p>
<p> </p>
<p>t</p>
<p>Any state except</p>
<p>Repeat Message</p>
<p>Immediate Nm</p>
<p>CycleTime</p>
<p>Immediate Nm</p>
<p>CycleTime</p>
<p>Immediate Nm</p>
<p>CycleTime</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Behavior with n := Immediate Nm Transmissions &gt; 0</p>
<p>0</p>
<p>Repeat Message</p>
<p>CanNm_NetworkRequest</p>
<p>1st</p>
<p>2nd</p>
<p>3rd</p>
<p>(n-1)th</p>
<p>nth</p>
<p>Msg Cycle Time</p>
<p>...</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>36 </p>
<p>based on template version 5.2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>This feature should not be confused with the possibility for an immediate transmission if </p>
<p>the ‘Com User Data Support’ feature is on (chapter 3.13) and should also not be </p>
<p>confused with the ‘Immediate Restart Enabled’ feature described in the following </p>
<p>chapter. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>If the send request of an ‘immediate transmission’ is rejected by the lower layer (e.g. </p>
<p>CanIf), the rejected send request is not considered as ‘immediate transmission’. That </p>
<p>means that the counter that counts the number of ‘immediate transmissions’ </p>
<p><i>ImmediateNmMsgCount </i>is not decremented. </p>
<p>Example: Let ‘Immediate Nm Transmissions’ := 2. The initial counter value of </p>
<p><i>ImmediateNmMsgCount </i>is 1. </p>
<p>1. </p>
<p>When Repeat Message has just been entered, the first transmission request </p>
<p><i>TReq</i></p>
<p><i>A</i></p>
<p> is rejected. <i>ImmediateNmMsgCount </i>is not decremented. </p>
<p>2. </p>
<p>CanNm waits ‘Immediate Msg CycleTime’ (first interval <i>t</i></p>
<p><i>int1st</i></p>
<p>). </p>
<p>3. </p>
<p>CanNm sends the NM message successfully. <i>ImmediateNmMsgCount </i>is </p>
<p>decremented to 0. </p>
<p>4. </p>
<p>CanNm waits ‘Immediate Msg CycleTime’ again (second interval <i>t</i></p>
<p><i>int2nd</i></p>
<p>). </p>
<p>5. </p>
<p>CanNm sends the next NM message successfully. </p>
<p>6. </p>
<p>Then ‘Msg Cycle Time’ is waited until the next NM message is sent because </p>
<p><i>ImmediateNmMsgCount </i>is already 0. </p>
<p>If the first NM transmission request <i>TReq</i></p>
<p><i>A</i></p>
<p> was successful (step 1), the second interval </p>
<p>time <i>t</i></p>
<p><i>int2nd</i></p>
<p> would be ‘Msg Cycle Time’ instead of ‘Immediate Msg CycleTime’. </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>3.16 </b></p>
<p><b>Immediate Restart Enabled </b></p>
<p>This feature enables the possibility to send an additional NM message upon the transition </p>
<p>from Prepare Bus Sleep to Repeat Message if and only if the network is requested actively </p>
<p>(e.g. there is a request for Full Communication in ComM). </p>
<p> </p>
<p>Figure 3-5 </p>
<p>Behavior for NM Transmissions if Immediate Restart Enabled is ON </p>
<p>t</p>
<p>Prepare Bus Sleep</p>
<p>Msg Cycle Offset</p>
<p>Msg Cycle Time</p>
<p>Msg Cycle Time</p>
<p>...</p>
<p>NM Message Transmissions</p>
<p>Behavior with Immediate Restart Enabled</p>
<p>0</p>
<p>Repeat Message</p>
<p>CanNm_NetworkRequest</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>37 </p>
<p>based on template version 5.2.0 </p>
<p>This  behavior  is  depicted  in  Figure  3-5.  Note  that  the  only  difference  to  the  standard </p>
<p>transmission  behavior  (i.e.  ‘Immediate  Restart  Enabled’  would  be  OFF,  for  the  behavior </p>
<p>see  also  chapter  3.6.3)  is  the  additional  NM  message  right  after  Repeat  Message  has </p>
<p>been entered. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The additional NM message is only sent if the ‘Msg Cycle Offset’ setting is greater than </p>
<p>0 and if ‘Immediate Nm Transmissions’ = 0 (refer to chapter 3.15 for details). </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.17 </b></p>
<p><b>Car Wake-up </b></p>
<p>Every  ECU  shall  be  able  to  wake  up  all  other  ECUs  of  the  car.  This  wake-up  request </p>
<p>information is contained in the NM message user data of an ECU. The central gateway </p>
<p>ECU </p>
<p>evaluates </p>
<p>the </p>
<p>Car </p>
<p>Wake-up </p>
<p>request </p>
<p>information </p>
<p>and </p>
<p>wakes </p>
<p>up </p>
<p>all </p>
<p>connected </p>
<p>communication channels. </p>
<p>This feature is optional and has to be configured. </p>
<p><b>3.17.1 </b></p>
<p><b>Rx-Path </b></p>
<p>If  the  CAN  NM  receives  a  NM  message  it  evaluates  the  user  data  content.  If  the  Car </p>
<p>Wake-up Bit is set and the Node ID passes a filter (if Node ID filter is enabled) the CAN </p>
<p>NM notifies the NM via the following callback function: </p>
<p>Nm_CarWakeUpIndication() </p>
<p>(</p>
<p>5.4</p>
<p>) </p>
<p> </p>
<p><b>3.17.2 </b></p>
<p><b>Tx-Path </b></p>
<p>For the transmission of the Car Wake-up Bit it has to be set at the corresponding location </p>
<p>within  the  NM  user  data.  If  the  feature  ‘Com  User  Data  Support’  is  used  and  the </p>
<p>corresponding signal and I-PDU are configured for directly transmitting a changed signal </p>
<p>the information is sent immediately. Refer also to chapter 3.13 ‘Com User Data Support’. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Info </b></p>
<p>It is recommended to use the feature ‘Com User Data Support’ for the transmission </p>
<p>path. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>3.18 </b></p>
<p><b>Partial Networking </b></p>
<p>To </p>
<p>reduce </p>
<p>the </p>
<p>power </p>
<p>consumption </p>
<p>of </p>
<p>ECUs </p>
<p>it </p>
<p>shall </p>
<p>be </p>
<p>possible </p>
<p>to </p>
<p>switch </p>
<p>off </p>
<p>the </p>
<p>communication  stack  during  active  bus  communication.  To  control  the  shutdown  and </p>
<p>wake-up of such ECUs the CAN NM provides an additional algorithm. The NM message </p>
<p>user  data  contains  the  information  which  partial  networks  (PN)  are  requested.  This </p>
<p>information is evaluated by the CAN NM and provided to the upper layer in an aggregated </p>
<p>form by updating the content of additional I-PDUs in the Com. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>38 </p>
<p>based on template version 5.2.0 </p>
<p>Algorithm details are described in the following sub-chapters. </p>
<p>This feature and all of its sub-features are optional and have to be configured </p>
<p><b>3.18.1 </b></p>
<p><b>Availability of Partial Network Request Information </b></p>
<p>To distinguish between NM messages containing PN cluster request information (CRI) and </p>
<p>NM messages without CRI a special bit in the control bit vector (bit 6) is used. Only if this </p>
<p>bit is set the NM message contains PN information and will be processed by the algorithm. </p>
<p><b>3.18.2 </b></p>
<p><b>Transmission of the CRI Bit in the NM User Data </b></p>
<p>The  CAN  NM  sets  the  CRI  Bit  at  bit  position  6  in  the  Control  Bit  Vector  to  1  for  each </p>
<p>channel if the Partial Networking feature is enabled on the corresponding channel. </p>
<p><b>3.18.3 </b></p>
<p><b>Filter Algorithm for Received NM Messages </b></p>
<p>NM messages that are not relevant for an ECU with PN must be dropped. Therefore the </p>
<p>content of received NM messages is evaluated after the filter algorithm described in this </p>
<p>section has been activated. Otherwise the usual way of receiving messages is being used. </p>
<p>The filter is disabled after the initialization of the CAN NM module. The message reception </p>
<p>filter  is  being  activated  after  a  call  of  CanNm_ConfirmPnAvailability  (refer  to  chapter </p>
<p>5.5.2.1 </p>
<p>‘CanNm_ConfirmPnAvailability: </p>
<p>Notification </p>
<p>for </p>
<p>Activating </p>
<p>the </p>
<p>PN </p>
<p>Filter </p>
<p>Functionality’ for further details). The filter is disabled in case the channel is started again, </p>
<p>by either an internal or external event and ‘CanNm_ConfirmPnAvailability’ was not called. </p>
<p>The filter algorithm works as follows: </p>
<p>If the CRI bit is cleared the NM message is not relevant for the ECU. </p>
<p>If  the  CRI  bit  is  set  the  CAN  NM  evaluates  the  CRI  content  of  the  NM  message.  The </p>
<p>location and the length of the CRI in the NM user data can be configured. Each bit within </p>
<p>the  CRI  content  represents  one  cluster. The  corresponding  cluster  is  being  requested  if </p>
<p>and only if the bit that belongs to the cluster is set. Because not every cluster is relevant </p>
<p>for the ECU a configurable PN filter mask is applied to the CRI content. Irrelevant cluster </p>
<p>requests can be ignored by setting the corresponding bit in the filter to 0. If at least one bit </p>
<p>within  the  received  PN  information  matches  with  a  bit  in  the  PN  filter  mask  the  NM </p>
<p>message is relevant for the ECU, otherwise the NM message is not relevant for the ECU. </p>
<p>If a NM message is not relevant and the configuration parameter ’All Nm Messages Keep </p>
<p>Awake’ is true the standard NM message reception handling is done, otherwise the NM </p>
<p>message is ignored. </p>
<p>If a NM message is relevant the CAN NM performs the standard NM message reception </p>
<p>and  additionally  the  filtered  PN  content  of  this  message  is  used  for  the  further  PN </p>
<p>algorithm. </p>
<p><b>3.18.4 </b></p>
<p><b>Aggregation of Requested Partial Networks </b></p>
<p>The  CAN  NM  aggregates  requested  PN  information  by  two  slightly  different  algorithms. </p>
<p>First  the  external  (received)  and  internal  (sent)  PN  requests  are  aggregated  over  all </p>
<p>networks  (channels)  to  a  combined  state  called  External  Internal  Requests Aggregated </p>
<p>(EIRA). Second only the external (received) PN requests are aggregated for each network </p>
<p>to  the  so  called  External  Requests  Aggregated  (ERA)  state.  Both  algorithms  can  be </p>
<p>activated independently in the configuration.  </p>
<p>For the EIRA algorithm every received or sent NM message on any network is evaluated </p>
<p>and  the  relevant  PN  information  (according  to  the  PN  filter  mask  and  the  CRI  bit)  is </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>39 </p>
<p>based on template version 5.2.0 </p>
<p>combined  to  one  aggregated  state.  Therefore  this  state  contains  the  information  which </p>
<p>partial networks are active on the whole ECU. </p>
<p>The ERA algorithm performs the evaluation of the received NM messages and storage of </p>
<p>the relevant PN information (according to the PN filter mask and the CRI bit) per network. </p>
<p>Therefore the ERA state contains for each network the information which partial networks </p>
<p>are requested by other ECUs and have to be active due to external needs. </p>
<p>Whenever a cluster is requested the first time (i.e. a bit is set the first time within this PN </p>
<p>information) the new request is stored and a timer is started. When the request is repeated </p>
<p>before  the  timer  elapses  the  timer  is  restarted.  When  the  timer  elapses  the  request  is </p>
<p>deleted. </p>
<p>Any change (storing or deleting a request) within the EIRA or ERA leads to an update of </p>
<p>the  content  of  the  EIRA  or  ERA  I-PDU  in  the  Com.  Therefore  the  following  function  is </p>
<p>called with the corresponding EIRA or ERA PDU handle: </p>
<p>PduR_CanNmRxIndication() </p>
<p>(5.4) </p>
<p>Note that one ERA I-PDU exists for each network. </p>
<p><b>3.18.5 </b></p>
<p><b>Spontaneous Sending of NM Messages </b></p>
<p>When  a  new  PN  is  internally  requested  the  corresponding  bit  in  the  NM  message  user </p>
<p>data  will  be  set.  This  request  must  be  immediately  visible  on  the  bus  by  sending  the </p>
<p>updated user data content as fast as possible. Therefore two mechanisms can be used. </p>
<p><b>3.18.5.1 </b></p>
<p><b>Using Com Transmission on Change Mechanism </b></p>
<p>When  the  NM  user  data  is  set  via  Com  the  signals  can  be  configured  for  immediate </p>
<p>transmission  on  change.  This  would  lead  to  one  additional  NM  message  transmission </p>
<p>whenever the content of the signal changes. Refer also to chapter  3.13 ‘Com User Data </p>
<p>Support’. </p>
<p>To  enable  this  behavior,  the  setting  ‘Pn  Handle  Multiple  Network  Requests’  has  to  be </p>
<p>turned OFF. </p>
<p><b>3.18.5.2 </b></p>
<p><b>Using NM Request and Immediate Nm Transmission </b></p>
<p>When CAN NM is in Network Mode and the upper layer requests network again by calling </p>
<p>the  function  ‘CanNm_NetworkRequest’  (see  chapter  5.3.2.4.1‘CanNm_NetworkRequest: </p>
<p>Request  the  Network’  for  details)  the  CAN  NM  performs  a  state  transition  to  Repeat </p>
<p>Message.  This  leads  to  an  immediate  transmission  of  the  NM  message  followed  by </p>
<p>several transmissions with a faster cycle time. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>Note that the feature ‘Immediate Nm Transmission’ (refer to chapter 3.15 ‘Immediate </p>
<p>Nm Transmissions’) must be enabled when using this mechanism for spontaneous </p>
<p>sending of NM messages. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Note that this mechanism will only be active if PN feature is enabled. </p>
<p>To  enable  this  behavior,  the  setting  ‘Pn  Handle  Multiple  Network  Requests’  has  to  be </p>
<p>turned ON. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>40 </p>
<p>based on template version 5.2.0 </p>
<p><b>4. </b></p>
<p><b>Integration </b></p>
<p>This chapter gives  necessary  information for the  integration of  the  MICROSAR  CANNM </p>
<p>into an application environment of an ECU. </p>
<p><b>4.1 </b></p>
<p><b>Scope of Delivery </b></p>
<p>The delivery of the  CANNM contains the files which are described in the chapters  4.1.1 </p>
<p>and 4.1.2: </p>
<p><b>4.1.1 </b></p>
<p><b>Static Files </b></p>
<p><b>File Name </b></p>
<p><b>Source </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Object </b></p>
<p><b>Code </b></p>
<p><b>Delivery </b></p>
<p><b>Description </b></p>
<p>CanNm.c </p>
<p></p>
<p> </p>
<p> </p>
<p>Source code of CAN NM. </p>
<p>The user <b>must not </b>change this file! </p>
<p>CanNm.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>API of CAN NM. </p>
<p>The user <b>must not </b>change this file! </p>
<p>CanNm_Cbk.h </p>
<p></p>
<p> </p>
<p></p>
<p> </p>
<p>API of CAN NM callback functions. </p>
<p>The user <b>must not </b>change this file! </p>
<p>Table 4-1  </p>
<p>Static files </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Do not edit manually </b></p>
<p>The static files listed above must not be edited by the user! </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.1.2 </b></p>
<p><b>Dynamic Files </b></p>
<p>The dynamic files are generated by the configuration tool DaVinci Configurator. </p>
<p><b>File Name </b></p>
<p><b>Description </b></p>
<p>CanNm_Cfg.c </p>
<p>Pre-compile variant configuration source file. </p>
<p>The user <b>must not </b>change this file! </p>
<p>CanNm_Cfg.h </p>
<p>Configuration header file for CAN NM. </p>
<p>The user <b>must not </b>change this file! </p>
<p>CanNm_Lcfg.c </p>
<p>Link-time variant Configuration source file. </p>
<p>The user <b>must not </b>change this file! </p>
<p>CanNm_Pbcfg.c </p>
<p>Post-build variant Configuration source file. </p>
<p>The user <b>must not </b>change this file! </p>
<p>Table 4-2  </p>
<p>Generated files </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>41 </p>
<p>based on template version 5.2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Do not edit manually </b></p>
<p>The dynamic files listed above must not be edited by the user! They should be </p>
<p>generated with the configuration tool to guarantee valid parameters. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.2 </b></p>
<p><b>Include Structure </b></p>
<p> </p>
<p>Figure 4-1 </p>
<p>Include structure </p>
<p> </p>
<p><b> class IncludeStructure</b></p>
<p>CanNm.c</p>
<p>CanNm.h</p>
<p>CanNm_Cfg.h</p>
<p>CanNm_Lcfg.c</p>
<p>CanNm_PBcfg.c</p>
<p>CanNm_Cbk.h</p>
<p>SchM_CanNm.h</p>
<p>CanSM_TxTimeOutException.h</p>
<p>PduR_CanNm.h</p>
<p>Nm_Cbk.h</p>
<p>ComM_Nm.h</p>
<p>ComM_Types.h</p>
<p>CanIf.h</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<p>«include»</p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>42 </p>
<p>based on template version 5.2.0 </p>
<p><b>4.3 </b></p>
<p><b>Main Functions </b></p>
<p>The CAN NM contains one main function that has to be called cyclically on task level. The </p>
<p>default timing value is 10 milliseconds. The call cycle time value for the main function has </p>
<p>to be set in the configuration settings (Setting: ‘Main Function Period’). </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In an AUTOSAR environment where the BSW Scheduler (SchM) is used the main </p>
<p>functions are called by the SchM and must not be called by the application. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>4.4 </b></p>
<p><b>Critical Sections </b></p>
<p>Critical  Sections  are  handled  by  the  RTE  [7].  They  are  automatically  configured  by  the </p>
<p>DaVinci Configurator. User interaction is only necessary by updating the internal behavior </p>
<p>using  the  solving  action  in  DaVinci  Configurator.  It  is  signaled  as  a  Warning  in  the </p>
<p>Validation tab. </p>
<p>The CAN NM calls the following function when entering a critical section: </p>
<p><b>SchM_Enter_CanNm_CANNM_EXCLUSIVE_AREA_i</b>() </p>
<p>(5.4) </p>
<p>When the critical section is left the following function is called by the CAN NM: </p>
<p><b>SchM_Enter_CanNm_CANNM_EXCLUSIVE_AREA_i</b>() </p>
<p>(5.4) </p>
<p>Details which section needs what kind of interrupt lock are provided in chapter 4.5 ‘Critical </p>
<p>Section Codes’. </p>
<p><b>4.5 </b></p>
<p><b>Critical Section Codes </b></p>
<p>The  CAN  NM  provides  several  critical  section  codes  which  must  lead  to  corresponding </p>
<p>interrupt locks, described in the following table: </p>
<p><b>Critical Section Define </b></p>
<p><b>Interrupt Lock </b></p>
<p>CANNM_EXCLUSIVE_AREA_0</p>
<p> </p>
<p>No interruption by any interrupt is allowed. Therefore this section </p>
<p>must always lock global interrupts. </p>
<p>CANNM_EXCLUSIVE_AREA_1 </p>
<p>No interruption of CanNm_MainFunction by CanNm_SetUserData </p>
<p>or CanNm_SetSleepReadyBit allowed. </p>
<p>This means that global interrupts have to be used for this section </p>
<p>only if CanNm_MainFunction can be interrupted by one of the </p>
<p>following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_SetUserData </p>
<p><b>&gt; </b></p>
<p>CanNm_SetSleepReadyBit </p>
<p>Otherwise no interrupt locks are necessary. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>43 </p>
<p>based on template version 5.2.0 </p>
<p>CANNM_EXCLUSIVE_AREA_2 </p>
<p>No interruption of CanNm_SetUserData by CanNm_MainFunction </p>
<p>allowed. </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_SetUserData can be interrupted by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_MainFunction </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>CANNM_EXCLUSIVE_AREA_3 </p>
<p>No interruption of CanNm_SetSleepReadyBit by </p>
<p>CanNm_MainFunction allowed </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_SetSleepReadyBit can be interrupted by the following </p>
<p>functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_MainFunction </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>CANNM_EXCLUSIVE_AREA_4 </p>
<p>No interruption of CanNm_RxIndication by CanNm_GetUserData or </p>
<p>CanNm_GetPduData allowed </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_RxIndication can be interrupted by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_GetUserData </p>
<p><b>&gt; </b></p>
<p>CanNm_GetPduData </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>CANNM_EXCLUSIVE_AREA_5 </p>
<p>No interruption of CanNm_GetUserData or CanNm_GetPduData by </p>
<p>CanNm_RxIndication allowed </p>
<p>This means that global interrupts must be locked if </p>
<p>CanNm_GetUserData or CanNm_GetPduData can be interrupted </p>
<p>by the following functions: </p>
<p><b>&gt; </b></p>
<p>CanNm_RxIndication </p>
<p>Otherwise no interrupt locks are necessary. </p>
<p>Table 4-3  </p>
<p>Critical Section Codes </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>44 </p>
<p>based on template version 5.2.0 </p>
<p><b>5. </b></p>
<p><b>API Description </b></p>
<p>For an interfaces overview please see Figure 2-2. </p>
<p><b>5.1 </b></p>
<p><b>Data Types </b></p>
<p>The software module CAN NM uses the standard AUTOSAR data types that are defined </p>
<p>within </p>
<p>Std_Types.h</p>
<p> </p>
<p>and </p>
<p>the </p>
<p>platform </p>
<p>specific </p>
<p>data </p>
<p>types </p>
<p>that </p>
<p>are </p>
<p>defined </p>
<p>within </p>
<p>Platform_Types.h</p>
<p> </p>
<p>and </p>
<p>the </p>
<p>Communication </p>
<p>Stack </p>
<p>Types </p>
<p>defined </p>
<p>within </p>
<p>ComStack_Types.h</p>
<p>.  Furthermore  the  standard  AUTOSAR  NM  Stack  Types  defined </p>
<p>within </p>
<p>NmStack_Types.h</p>
<p> are used. </p>
<p>CAN NM also uses the Communication Stack Types defined within </p>
<p>ComStack_Types.h</p>
<p>. </p>
<p><b>5.2 </b></p>
<p><b>Global Constants </b></p>
<p><b>5.2.1 </b></p>
<p><b>AUTOSAR Specification Version </b></p>
<p>The version of AUTOSAR specification on which the appropriate implementation is based </p>
<p>on is provided by three BCD coded defines: </p>
<p> </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p>CANNM_AR_RELEASE_MAJOR_VERSION</p>
<p> </p>
<p>BCD </p>
<p>Contains the major specification version </p>
<p>number. </p>
<p>CANNM_AR_RELEASE_MINOR_VERSION</p>
<p> </p>
<p>BCD </p>
<p>Contains the minor specification version </p>
<p>number. </p>
<p>CANNM_AR_RELEASE_REVISION_VERSION </p>
<p>BCD </p>
<p>Contains the patch level specification </p>
<p>version number. </p>
<p>Table 5-1  </p>
<p>Specification Version API Data </p>
<p><b>5.2.2 </b></p>
<p><b>Component Versions </b></p>
<p>The  source  code  versions  of  CAN  NM  are  provided  by  three  BCD  coded  macros  (and </p>
<p>additionally as constants): </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p>CANNM_SW_MAJOR_VERSION </p>
<p>(CanNm_MainVersion)</p>
<p> </p>
<p>BCD </p>
<p>Contains the major component version number. </p>
<p>CANNM_SW_MINOR_VERSION </p>
<p>(CanNm_SubVersion)</p>
<p> </p>
<p>BCD </p>
<p>Contains the minor component version number. </p>
<p>CANNM_SW_PATCH_VERSION </p>
<p>(CanNm_ReleaseVersion) </p>
<p>BCD </p>
<p>Contains the patch level component version number. </p>
<p>Table 5-2  </p>
<p>Component Version API Data </p>
<p>These constants are declared as external and can be read by the application at any time. </p>
<p><b>5.2.3 </b></p>
<p><b>Vendor and Module ID </b></p>
<p>CAN NM provides the vendor identifier according to AUTOSAR as defines: </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>45 </p>
<p>based on template version 5.2.0 </p>
<p><b>Name </b></p>
<p><b>Type </b></p>
<p><b>Description </b></p>
<p><b>Value </b></p>
<p>CANNM_VENDOR_ID</p>
<p> </p>
<p>- </p>
<p>Vendor ID according to AUTOSAR. </p>
<p>30 </p>
<p>CANNM_MODULE_ID</p>
<p> </p>
<p>- </p>
<p>Module ID according to AUTOSAR. </p>
<p>31 </p>
<p>Table 5-3  </p>
<p>Vendor/Module ID </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>46 </p>
<p>based on template version 5.2.0 </p>
<p><b>5.3 </b></p>
<p><b>Services Provided by CANNM </b></p>
<p><b>5.3.1 </b></p>
<p><b>Administrative Functions </b></p>
<p><b>5.3.1.1 </b></p>
<p><b>CanNm_Init: Initialization of CAN NM </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_Init </b>(const CanNm_ConfigType * const cannmConfigPtr) </p>
<p><b>Parameter </b></p>
<p>cannmConfigPtr </p>
<p>Configuration structure for initializing the module </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Initialization of the CAN Network Management (CANNM041) and its internal state machine. By default the </p>
<p>NM starts in the Bus-Sleep Mode. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>The function CanNm_Init() has to be called before any other CanNm service function is called </p>
<p>(except CanNm_InitMemory()). </p>
<p><b>&gt; </b></p>
<p>During the execution of the function CanNm_Init(), it has to be ensured that the execution is </p>
<p>not interrupted by any other function of the CanNm module. This can for instance be </p>
<p>accomplished by </p>
<p><b>&gt; </b></p>
<p>global interrupt locks OR </p>
<p><b>&gt; </b></p>
<p>CAN interrupt locks. </p>
<p><b>&gt; </b></p>
<p>In Variant post-build-selectable and post-build-loadable a valid configuration pointer has to be </p>
<p>passed in the CanNm_Init function call. </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task level </p>
<p>Table 5-4  </p>
<p>CanNm_Init </p>
<p><b>5.3.1.2 </b></p>
<p><b>CanNm_MainFunction: Main Function for All Channel Instances </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_MainFunction </b>(void) </p>
<p><b>Parameter </b></p>
<p>- </p>
<p>- </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>47 </p>
<p>based on template version 5.2.0 </p>
<p><b>Functional Description </b></p>
<p>Main function of the CanNm which processes the NM algorithm. This function is responsible to handle all </p>
<p>CanNm instances. (CANNM234). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by SchM. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task level </p>
<p>Table 5-5  </p>
<p>CanNm_MainFunction </p>
<p><b>5.3.1.3 </b></p>
<p><b>CanNm_InitMemory: Memory Initialization </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_InitMemory </b>(void) </p>
<p><b>Parameter </b></p>
<p>-</p>
<p> </p>
<p>- </p>
<p><b>Return code </b></p>
<p>-</p>
<p> </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Initialize Memory, so that expected start values are set. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by the Application. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>System startup </p>
<p>Table 5-6  </p>
<p>CanNm_InitMemory </p>
<p><b>5.3.2 </b></p>
<p><b>Service Functions </b></p>
<p><b>5.3.2.1 </b></p>
<p><b>CanNm_GetVersionInfo: Version Information API </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_GetVersionInfo </b>(Std_VersionInfoType *versioninfo) </p>
<p><b>Parameter </b></p>
<p>versioninfo </p>
<p>Pointer to where to store the version information of this module </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>48 </p>
<p>based on template version 5.2.0 </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>CanNm_GetVersionInfo() returns version information, vendor ID and AUTOSAR module ID of the </p>
<p>component. </p>
<p>The versions are BCD-coded. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is available if </p>
<p>CANNM_VERSION_INFO_API</p>
<p> is </p>
<p>STD_ON</p>
<p> </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task level </p>
<p>Table 5-7  </p>
<p>CanNm_GetVersionInfo </p>
<p><b>5.3.2.2 </b></p>
<p><b>CanNm_GetState: Get the State of the Network Management </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_GetState </b>( const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>Nm_StateType *  const  </p>
<p>nmStatePtr, </p>
<p> </p>
<p>Nm_ModeType *  const  </p>
<p>nmModePtr) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmStatePtr </p>
<p>Pointer where the state of the Network Management shall be copied to </p>
<p>nmModePtr </p>
<p>Pointer where the mode of the Network Management shall be copied to </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Getting the NM state has failed </p>
<p><b>Functional Description </b></p>
<p>Return current state and mode of the network management (CANNM223). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by NM Interface. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-8  </p>
<p>CanNm_GetState </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>49 </p>
<p>based on template version 5.2.0 </p>
<p><b>5.3.2.3 </b></p>
<p><b>CanNm_PassiveStartUp: Wake up the Network Management </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_PassiveStartUp </b>(const NetworkHandleType nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Start of network management has failed </p>
<p><b>Functional Description </b></p>
<p>Starts the NM from the Bus Sleep Mode and triggers a transition to the Network Mode (Repeat Message </p>
<p>State) (CANNM211). This service has no effect if the current state is not equal to Bus Sleep Mode or </p>
<p>Prepare Bus Sleep Mode. In that case E_NOT_OK is returned. </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by NM Interface. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-9  </p>
<p>CanNm_PassiveStartUp </p>
<p><b>5.3.2.4 </b></p>
<p><b>Wake-up Registration </b></p>
<p><b>5.3.2.4.1 </b></p>
<p><b>CanNm_NetworkRequest: Request the Network </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_NetworkRequest </b>(const NetworkHandleType nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Requesting bus-communication has failed </p>
<p><b>Functional Description </b></p>
<p>Request the network, since ECU needs to communicate on the bus (CANNM213). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by NM Interface. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>50 </p>
<p>based on template version 5.2.0 </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-10  </p>
<p>CanNm_NetworkRequest </p>
<p><b>5.3.2.4.2 </b></p>
<p><b>CanNm_NetworkRelease: Release the Network </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_NetworkRelease </b>(const NetworkHandleType nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Releasing bus-communication has failed </p>
<p><b>Functional Description </b></p>
<p>Release the network, since ECU doesn't have to communicate on the bus (CANNM214). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by NM Interface. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-11  </p>
<p>CanNm_NetworkRelease </p>
<p><b>5.3.2.5 </b></p>
<p><b>User Data Handling </b></p>
<p><b>5.3.2.5.1 </b></p>
<p><b>CanNm_SetUserData: Set User Data </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_SetUserData </b>( const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>const uint8 * const  </p>
<p>nmUserDataPtr) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmUserDataPtr </p>
<p>Pointer to User data for the next transmitted NM message shall be copied </p>
<p>from </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Setting of user data has failed </p>
<p><b>Functional Description </b></p>
<p>Set user data for NM messages transmitted next on the bus (CANNM217). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>51 </p>
<p>based on template version 5.2.0 </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-12  </p>
<p>CanNm_SetUserData </p>
<p><b>5.3.2.5.2 </b></p>
<p><b>CanNm_GetUserData: Get User Data </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_GetUserData </b>( const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>uint8 * const  </p>
<p>nmUserDataPtr) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmUserDataPtr </p>
<p>Pointer where user data out of the last received NM message shall be copied </p>
<p>to </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Getting of user data has failed </p>
<p><b>Functional Description </b></p>
<p>Get user data out of the last NM messages received from the bus (CANNM218). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-13  </p>
<p>CanNm_GetUserData </p>
<p><b>5.3.2.5.3 </b></p>
<p><b>CanNm_GetPduData: Get NM PDU Data </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_GetPduData </b>( const NetworkHandleType  nmChannelHandle, </p>
<p> </p>
<p>uint8 * const  </p>
<p>nmPduDataPtr) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmPduDataPtr </p>
<p>Pointer where PDU Data out of the most recently received NM message shall </p>
<p>be copied to </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>52 </p>
<p>based on template version 5.2.0 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Getting the PDU data has failed </p>
<p><b>Functional Description </b></p>
<p>Get the whole PDU data out of the last NM message received from the bus (CANNM138). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface. </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-14  </p>
<p>CanNm_GetPduData </p>
<p><b>5.3.2.6  Node Detection </b></p>
<p><b>5.3.2.6.1 </b></p>
<p><b>CanNm_RepeatMessageRequest: Set Repeat Message Request Bit </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_RepeatMessageRequest </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Repeat Message Request has failed </p>
<p><b>Functional Description </b></p>
<p>Request state change to Repeat Message State (CANNM221). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-15  </p>
<p>CanNm_RepeatMessageRequest </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>53 </p>
<p>based on template version 5.2.0 </p>
<p><b>5.3.2.6.2 </b></p>
<p><b>CanNm_GetNodeIdentifier: Get Node Identifier </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_GetNodeIdentifier </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<p> </p>
<p>uint8 * const nmNodeIdPtr) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmNodeIdPtr </p>
<p>Pointer where node identifier from the last received NM message shall be </p>
<p>copied to </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Getting of node identifier has failed </p>
<p><b>Functional Description </b></p>
<p>Get node identifier of the last received NM message (CANNM219). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-16  </p>
<p>CanNm_GetNodeIdentifier </p>
<p><b>5.3.2.6.3 </b></p>
<p><b>CanNm_GetLocalNodeIdentifier: Get Local Node Identifier </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_GetLocalNodeIdentifier </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<p> </p>
<p>uint8 * const nmNodeIdPtr) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmNodeIdPtr </p>
<p>Pointer where node identifier of the local node shall be copied to </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Getting of local node identifier has failed </p>
<p><b>Functional Description </b></p>
<p>Get node identifier configured for the local node (CANNM220). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>54 </p>
<p>based on template version 5.2.0 </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-17  </p>
<p>CanNm_GetLocalNodeIdentifier </p>
<p><b>5.3.2.7 </b></p>
<p><b>Bus Synchronization </b></p>
<p><b>5.3.2.7.1 </b></p>
<p><b>CanNm_RequestBusSynchronization: Synchronization of Networks </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_RequestBusSynchronization </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Requesting bus synchronization has failed </p>
<p><b>Functional Description </b></p>
<p>Request bus synchronization (CANNM226) (Transmission of an asynchronous NM message to support </p>
<p>coordination of coupled networks). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task level </p>
<p>Table 5-18  </p>
<p>CanNm_RequestBusSynchronization </p>
<p><b>5.3.2.8 </b></p>
<p><b>Remote Sleep Indication </b></p>
<p><b>5.3.2.8.1 </b></p>
<p><b>CanNm_CheckRemoteSleepIndication: Check for Remote Sleep </b></p>
<p><b>Indication </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_CheckRemoteSleepIndication </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<p> </p>
<p>boolean * const </p>
<p> </p>
<p>nmRemoteSleepIndPtr) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>55 </p>
<p>based on template version 5.2.0 </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmRemoteSleepIndPtr </p>
<p>Pointer where PDU Data out of the most recently received NM message shall </p>
<p>be copied to </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Checking remote sleep indication has failed </p>
<p><b>Functional Description </b></p>
<p>Check if remote sleep was indicated or not (CANNM227). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-19  </p>
<p>CanNm_CheckRemoteSleepIndication </p>
<p><b>5.3.2.9 </b></p>
<p><b>NM Message Transmission Request </b></p>
<p><b>5.3.2.9.1 </b></p>
<p><b>CanNm_Transmit: Spontaneous NM Message Transmission </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_Transmit </b>( PduIdType CanNmTxPduId, </p>
<p> </p>
<p>const PduInfoType *PduInfoPtr) </p>
<p><b>Parameter </b></p>
<p>CanNmTxPduId </p>
<p>L-PDU handle of CAN L-PDU to be transmitted. This handle specifies the </p>
<p>corresponding CAN LPDU ID and implicitly the CAN Driver instance as well as </p>
<p>the corresponding CAN controller device. </p>
<p>PduInfoPtr </p>
<p>Pointer to a structure with CAN L-PDU related data: DLC and pointer to CAN </p>
<p>L-SDU buffer. </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  transmit request has not been accepted due to wrong state </p>
<p><b>Functional Description </b></p>
<p>This function is used by the PduR to trigger a spontaneous transmission of an NM message with the </p>
<p>provided NM User Data (CANM331). </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>56 </p>
<p>based on template version 5.2.0 </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from PduR </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-20  </p>
<p>CanNm_Transmit </p>
<p><b>5.3.2.10 </b></p>
<p><b>Communication Control Service </b></p>
<p><b>5.3.2.10.1 </b></p>
<p><b>CanNm_DisableCommunication: Disable NM Message Transmission </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_DisableCommunication </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Disable NM Message transmission control status has failed </p>
<p><b>Functional Description </b></p>
<p>Disable NM message transmission control status (CANNM215). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-21  </p>
<p>CanNm_DisableCommunication </p>
<p><b>5.3.2.10.2 </b></p>
<p><b>CanNm_EnableCommunication: Enabled NM Message Transmission </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_EnableCommunication </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>57 </p>
<p>based on template version 5.2.0 </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Enabling NM Message transmission control status has failed </p>
<p><b>Functional Description </b></p>
<p>Enable NM message transmission control status (CANNM216). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-22  </p>
<p>CanNm_EnableCommunication </p>
<p><b>5.3.2.11 </b></p>
<p><b>Coordinator Synchronization Support </b></p>
<p><b>5.3.2.11.1 </b></p>
<p><b>CanNm_SetSleepReadyBit: Set Sleep Ready Bit in the CBV </b></p>
<p><b>Prototype </b></p>
<p>Std_ReturnType <b>CanNm_SetSleepReadyBit </b>( const NetworkHandleType </p>
<p> </p>
<p>nmChannelHandle, </p>
<p> </p>
<p>const boolean nmSleepReadyBit) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p>nmSleepReadyBit </p>
<p>Value written to Ready Sleep Bit in CBV </p>
<p><b>Return code </b></p>
<p>Std_ReturnType </p>
<p>E_OK </p>
<p>-  No error </p>
<p>E_NOT_OK </p>
<p>-  Writing of Sleep Ready Bit has failed </p>
<p><b>Functional Description </b></p>
<p>Set the NM Coordinator Sleep Ready bit in the Control Bit Vector (CANNM338). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from NM Interface </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task level </p>
<p>Table 5-23  </p>
<p>CanNm_SetSleepReadyBit </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>58 </p>
<p>based on template version 5.2.0 </p>
<p><b>5.4 </b></p>
<p><b>Services Used by CANNM </b></p>
<p>In  the  following  table  services  provided  by  other  components,  which  are  used  by  the </p>
<p>CANNM are listed. For details about prototype and functionality refer to the documentation </p>
<p>of the providing component. </p>
<p><b>Component </b></p>
<p><b>API </b></p>
<p>CanIf </p>
<p>CanIf_Transmit</p>
<p>8</p>
<p> </p>
<p>CanSM </p>
<p>CanSM_TxTimeoutException</p>
<p>9</p>
<p> </p>
<p>DET </p>
<p>Det_ReportError</p>
<p>10</p>
<p> </p>
<p>NM </p>
<p>Nm_CarWakeUpIndication</p>
<p>11</p>
<p> </p>
<p>Nm_BusSleepMode </p>
<p>Nm_CoordReadyToSleepIndication</p>
<p>12</p>
<p> </p>
<p>Nm_CoordReadyToSleepCancellation</p>
<p>12</p>
<p> </p>
<p>Nm_NetworkMode </p>
<p>Nm_NetworkStartIndication </p>
<p>Nm_PduRxIndication</p>
<p>13</p>
<p> </p>
<p>Nm_CanNm_PduRxIndication</p>
<p>14</p>
<p> </p>
<p>Nm_PrepareBusSleepMode </p>
<p>Nm_RemoteSleepCancellation</p>
<p>15</p>
<p> </p>
<p>Nm_RemoteSleepIndication</p>
<p>15</p>
<p> </p>
<p>Nm_RepeatMessageIndication</p>
<p>16</p>
<p> </p>
<p>Nm_StateChangeNotification</p>
<p>17</p>
<p> </p>
<p>Nm_TxTimeoutException</p>
<p>8,18</p>
<p> </p>
<p>PduR </p>
<p>PduR_CanNmTriggerTransmit</p>
<p>8,19</p>
<p> </p>
<p>PduR_CanNmTxConfirmation</p>
<p>8,19,20</p>
<p> </p>
<p>PduR_CanNmRxIndication</p>
<p>21</p>
<p> </p>
<p>SchM </p>
<p>SchM_Enter_CanNm_CANNM_EXCLUSIVE_AREA_i </p>
<p>SchM_Exit_CanNm_CANNM_EXCLUSIVE_AREA_i </p>
<p>for i=0,…,5 </p>
<p>Table 5-24  </p>
<p>Services used by the CANNM </p>
<p>                                            </p>
<p>8</p>
<p> Service only used if the feature ‘Passive Mode’ is disabled </p>
<p>9</p>
<p> Service only used if ‘Immediate Tx Conf Enabled’ is disabled and ‘Pn Enabled’ is enabled and if CanSM </p>
<p>provides this function </p>
<p>10</p>
<p> Service only used if the feature ‘Dev Error Detect’ is enabled </p>
<p>11</p>
<p> Service only used if the feature ‘Car Wake Up Rx Enabled’ is enabled. </p>
<p>12</p>
<p> Service only used if the feature ‘Coordinator Sync Support’ is enabled. </p>
<p>13</p>
<p> Service only used if the feature ‘Pdu Rx Indication Enabled’ is enabled. </p>
<p>14</p>
<p> Service only used if the feature ‘Bus Nm Specific Pdu Rx Indication Enabled‘ is enabled in NmIf. </p>
<p>15</p>
<p> Service only used if the feature ‘Remote Sleep Ind Enabled’ is enabled. </p>
<p>16</p>
<p> Service only used if the feature ‘Repeat Msg Ind Enabled’ is enabled. </p>
<p>17</p>
<p> Service only used if the feature ‘State Change Ind Enabled’ is enabled. </p>
<p>18</p>
<p> Service only used if the feature ‘Immediate Tx Conf Enabled’ is enabled. </p>
<p>19</p>
<p> Service only used if the feature ‘Com User Data Support’ is enabled. </p>
<p>20</p>
<p> Service only used if the feature ‘Immediate Txconf Enabled’ is disabled. </p>
<p>21</p>
<p> Service only used if the features ‘Pn Eira Calc Enabled’ or ‘Pn Era Calc Enabled’ is enabled. </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>59 </p>
<p>based on template version 5.2.0 </p>
<p><b>5.5 </b></p>
<p><b>Callback Functions </b></p>
<p><b>5.5.1 </b></p>
<p><b>Callback Functions from CAN Interface </b></p>
<p><b>5.5.1.1 </b></p>
<p><b>CanNm_TxConfirmation: NM Message Confirmation Function </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_TxConfirmation </b>(PduIdType TxPduId) </p>
<p><b>Parameter </b></p>
<p>TxPduId </p>
<p>ID of CAN NM PDU that has been transmitted </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>This function is called by the CAN Interface after a CAN NM PDU has been successfully transmitted </p>
<p>(CANNM228). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is asynchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from data link layer </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-25  </p>
<p>CanNm_TxConfirmation </p>
<p><b>5.5.1.2 </b></p>
<p><b>CanNm_RxIndication: NM Message Indication </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_RxIndication </b>(PduIdType RxPduId, const PduInfoType *PduInfoPtr) </p>
<p><b>Parameter </b></p>
<p>RxPduId </p>
<p>ID of CAN NM PDU that has been received </p>
<p>PduInfoPtr </p>
<p>Pointer to a PduInfoType containing the received CAN NM SDU and its length </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>This function is called by the CAN Interface after a CAN L-PDU has been received (CANNM231). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is non-reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called from data link layer </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>60 </p>
<p>based on template version 5.2.0 </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-26  </p>
<p>CanNm_RxIndication </p>
<p><b>5.5.2 </b></p>
<p><b>Callback Function from CAN State Manager </b></p>
<p><b>5.5.2.1 </b></p>
<p><b>CanNm_ConfirmPnAvailability: Notification for Activating the PN Filter </b></p>
<p><b>Functionality </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanNm_ConfirmPnAvailability </b>(const NetworkHandleType nmChannelHandle) </p>
<p><b>Parameter </b></p>
<p>nmChannelHandle </p>
<p>Index of the network channel </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Enables the PN filter functionality on the indicated NM channel (CANM344). </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>Service ID: see table 'Service IDs' </p>
<p><b>&gt; </b></p>
<p>This function is reentrant. </p>
<p><b>&gt; </b></p>
<p>This function is synchronous. </p>
<p><b>&gt; </b></p>
<p>This function is called by CanSM </p>
<p>Expected Caller Context </p>
<p><b>&gt; </b></p>
<p>Task and interrupt level </p>
<p>Table 5-27  </p>
<p>CanNm_ConfirmPnAvailability </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>61 </p>
<p>based on template version 5.2.0 </p>
<p><b>6. </b></p>
<p><b>Glossary and Abbreviations </b></p>
<p><b>6.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p><b>Confirmation </b></p>
<p>Notification by the data link layer on asynchronous successful </p>
<p>transmission of a CAN message </p>
<p><b>Identifier </b></p>
<p>Identifies a CAN message </p>
<p><b>Indication </b></p>
<p>Notification by the data link layer on asynchronous reception of a CAN </p>
<p>message </p>
<p><b>Message </b></p>
<p>One or more signals are assigned to each message. </p>
<p><b>Signal </b></p>
<p>Signals describe the significance of the individual data segments within a </p>
<p>message. Typically bits, bytes or words are used for data segments but </p>
<p>individual bit combinations are also possible. In the CAN database, each </p>
<p>data segment is assigned a symbolic name, a value range, a conversion </p>
<p>formula and a physical unit, as well as a list of receiving nodes. </p>
<p>Table 6-1  </p>
<p>Glossary </p>
<p> </p>
<p> </p>
<p><b>6.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p><b>API </b></p>
<p><b>A</b>pplication <b>P</b>rogramming <b>I</b>nterface </p>
<p><b>AUTOSAR </b></p>
<p><b>Aut</b>omotive <b>O</b>pen <b>S</b>ystem <b>Ar</b>chitecture </p>
<p><b>BswM </b></p>
<p><b>B</b>asic <b>S</b>oftware <b>M</b>ode <b>Manager </b></p>
<p><b>CAN </b></p>
<p><b>C</b>ontroller <b>A</b>rea <b>N</b>etwork </p>
<p><b>CanIf </b></p>
<p><b>Can I</b>nter<b>f</b>ace </p>
<p><b>CCL </b></p>
<p><b>C</b>ommunication <b>C</b>ontrol <b>L</b>ayer </p>
<p><b>ComM </b></p>
<p><b>C</b>ommunication <b>M</b>anager </p>
<p><b>CRI </b></p>
<p>Partial Network <b>C</b>luster <b>R</b>equest <b>I</b>nformation </p>
<p><b>DET </b></p>
<p><b>D</b>evelopment <b>E</b>rror <b>T</b>racer </p>
<p><b>DEM </b></p>
<p><b>D</b>iagnostic <b>E</b>vent <b>M</b>anager </p>
<p><b>DLC </b></p>
<p><b>D</b>ata <b>L</b>ength <b>C</b>ode (Number of data bytes of a CAN message) </p>
<p><b>DLL </b></p>
<p><b>D</b>ata <b>l</b>ink <b>l</b>ayer </p>
<p><b>ECU </b></p>
<p><b>E</b>lectronic <b>C</b>ontrol <b>U</b>nit </p>
<p><b>EIRA </b></p>
<p><b>E</b>xternal <b>I</b>nternal <b>R</b>equests <b>A</b>ggregated </p>
<p><b>ERA </b></p>
<p><b>E</b>xternal <b>R</b>equests <b>A</b>ggregated </p>
<p><b>FIBEX </b></p>
<p><b>Fi</b>eld <b>B</b>us <b>Ex</b>change </p>
<p><b>ID </b></p>
<p><b>Id</b>entifier (of a CAN message) </p>
<p><b>IL </b></p>
<p><b>I</b>nteraction <b>L</b>ayer </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>62 </p>
<p>based on template version 5.2.0 </p>
<p><b>I-PDU </b></p>
<p><b>I</b>nteraction Layer <b>P</b>rotocol <b>D</b>ata <b>U</b>nit </p>
<p><b>ISR </b></p>
<p><b>I</b>nterrupt <b>S</b>ervice <b>R</b>outine </p>
<p><b>LIN </b></p>
<p><b>L</b>ocal <b>I</b>nterconnect <b>N</b>etwork </p>
<p><b>MISRA </b></p>
<p><b>M</b>otor <b>I</b>ndustry <b>S</b>oftware <b>R</b>eliability <b>A</b>ssociation </p>
<p><b>NM </b></p>
<p><b>N</b>etwork <b>M</b>anagement  </p>
<p><b>PDU </b></p>
<p><b>P</b>rotocol <b>D</b>ata <b>U</b>nit </p>
<p><b>PN </b></p>
<p><b>P</b>artial <b>N</b>etwork / <b>P</b>artial <b>N</b>etworking </p>
<p><b>RAM </b></p>
<p><b>R</b>andom <b>A</b>ccess <b>M</b>emory </p>
<p><b>RI </b></p>
<p><b>R</b>eference <b>I</b>mplementation </p>
<p>(Reference Implementation of the CAN-Driver High Level part) </p>
<p><b>ROM </b></p>
<p><b>R</b>ead <b>O</b>nly <b>M</b>emory </p>
<p><b>SchM </b></p>
<p><b>Sch</b>edule <b>M</b>anager (BSW Scheduler) </p>
<p><b>SRS </b></p>
<p><b>S</b>ystem <b>R</b>equirements <b>S</b>pecification (used for AUTOSAR documents) </p>
<p><b>SWS </b></p>
<p><b>S</b>oft<b>w</b>are <b>S</b>pecification (used for AUTOSAR documents) </p>
<p><b>UDP </b></p>
<p><b>U</b>ser <b>D</b>atagram <b>P</b>rotocol </p>
<p>Table 6-2  </p>
<p>Abbreviations </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference MICROSAR CAN Network Management </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 6.02.00 </p>
<p>63 </p>
<p>based on template version 5.2.0 </p>
<p><b>7. </b></p>
<p><b>Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p><b>&gt; </b></p>
<p>News </p>
<p><b>&gt; </b></p>
<p>Products </p>
<p><b>&gt; </b></p>
<p>Demo software </p>
<p><b>&gt; </b></p>
<p>Support </p>
<p><b>&gt; </b></p>
<p>Training data </p>
<p><b>&gt; </b></p>
<p>Addresses </p>
<p> </p>
<p>www.vector.com </p>
<p> </p>
<p> </p>
<p> </p>
</body>
</html>
{% endraw %}