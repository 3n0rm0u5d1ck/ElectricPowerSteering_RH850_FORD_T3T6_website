---
layout: default
title: TechnicalReference_CanXcp
nav_order: 2
parent: CanXcp
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>1 </p>
<p>based on template version 5.1.0 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>XCP on CAN </b></p>
<p>Technical Reference </p>
<p> </p>
<p>XCP on CAN Transport Layer for MICROSAR CanIf </p>
<p>Version 1.10.00 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>2 </p>
<p>based on template version 5.1.0 </p>
<p><b>Document Information </b></p>
<p><b>History </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>2007-01-26 </p>
<p>1.00.00 </p>
<p>ESCAN00017890: Creation of Cp_XcpOnCanAsr based on </p>
<p>Cp_XcpOnCan </p>
<p>2008-08-05 </p>
<p>1.01.00 </p>
<p>Adaptations to AUTOSAR R3 </p>
<p>2009-12-17 </p>
<p>1.02.00 </p>
<p>Support of a2l export. </p>
<p>2010-01-14 </p>
<p>1.03.00 </p>
<p>ESCAN00040120: Support MultiChannel </p>
<p>Removed Section 3.3 </p>
<p>2010-03-30 </p>
<p>1.04.00 </p>
<p>ESCAN00041935: Add feature to disable XcpOnCanAsr in serial </p>
<p>production ECUs </p>
<p>ESCAN00043225: Missing limitation for Multiple Identity with </p>
<p>several CAN channels </p>
<p>2011-01-04 </p>
<p>1.05.00 </p>
<p>ESCAN00046305: AR3-297 AR3-894: Support PduInfoType instead </p>
<p>of the DataPtr </p>
<p>2011-03-22 </p>
<p>1.06.00 </p>
<p>ESCAN00049434: Support Monitoring Hooks for AUTOSAR 4 </p>
<p>2012-04-10 </p>
<p>1.06.01 </p>
<p>ESCAN00052061: Added InitMemory function to chapter 8.2 </p>
<p>Added Option for AMD Runtime Measurement </p>
<p>2013-03-25 </p>
<p>1.06.02 </p>
<p>ESCAN00063622: Remove PduInfoType from TechRef </p>
<p>2013-05-27 </p>
<p>1.07.00 </p>
<p>ESCAN00066189: Change API CanXcp_Transmit to CanXcp_Send </p>
<p>ESCAN00070335: Remove Monitoring Hooks defined in ASR4 </p>
<p>ESCAN00069044: Critical Section Description is missing </p>
<p>2014-08-15 </p>
<p>1.07.01 </p>
<p>ESCAN00077233: AR3-2679: Description BCD-coded return-value </p>
<p>of CanXcp_GetVersionInfo() in TechRef </p>
<p>2016-02-10 </p>
<p>1.08.00 </p>
<p>ESCAN00082594: CAN-FD: Document support of mode 2 </p>
<p>2016-09-07 </p>
<p>1.09.00 </p>
<p>ESCAN00091770: FEAT-1980: Add Multi Client / Multi Connection </p>
<p>support </p>
<p>2016-10-28 </p>
<p>1.10.00 </p>
<p>Editorial changes </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Title </b></p>
<p>[1] </p>
<p>ASAM_XCP_Part1-Overview_V1-1-0.pdf </p>
<p>[2] </p>
<p>ASAM_AE_MCD-1-XCP_AS_CAN-Transport-Layer_V1-2-0.pdf </p>
<p>[3] </p>
<p>Technical Reference XCP Protocol Layer, Version 2.04.00 </p>
<p>[4] </p>
<p>AUTOSAR_SWS_DevelopmentErrorTracer.pdf V3.0.0 </p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviations </b></p>
<p><b>Complete expression </b></p>
<p>A2L </p>
<p>File Extension for an ASAM 2MC Language File </p>
<p>AML </p>
<p>ASAM 2 Meta Language </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>3 </p>
<p>based on template version 5.1.0 </p>
<p>API </p>
<p>Application Programming Interface </p>
<p>ASAM </p>
<p>Association for Standardization of Automation and Measuring Systems </p>
<p>CAN </p>
<p>Controller Area Network </p>
<p>CANape </p>
<p>Calibration and Measurement Data Acquisition for Electronic Control </p>
<p>Systems </p>
<p>CMD </p>
<p>Command </p>
<p>CTO </p>
<p>Command Transfer Object </p>
<p>DAQ </p>
<p>Synchronous Data Acquisition </p>
<p>DLC </p>
<p>Data Length Code ( Number of data bytes of a CAN message ) </p>
<p>DLL </p>
<p>Data link layer </p>
<p>DTO </p>
<p>Data Transfer Object </p>
<p>ECU </p>
<p>Electronic Control Unit </p>
<p>ID </p>
<p>Identifier (of a CAN message) </p>
<p>Identifier </p>
<p>Identifies a CAN message </p>
<p>ISR </p>
<p>Interrupt Service Routine </p>
<p>MCS </p>
<p>Master Calibration System </p>
<p>Message </p>
<p>One or more signals are assigned to each message. </p>
<p>MRB </p>
<p>Multi receive buffer </p>
<p>MRC </p>
<p>Multi receive channel </p>
<p>OEM </p>
<p>Original equipment manufacturer (vehicle manufacturer) </p>
<p>RES </p>
<p>Command Response Packet </p>
<p>SRB </p>
<p>Single receive buffer </p>
<p>SERV </p>
<p>Service Request Packet </p>
<p>STIM </p>
<p>Stimulation </p>
<p>XCP </p>
<p>Universal Measurement and Calibration Protocol </p>
<p>VI </p>
<p>Vector Informatik GmbH </p>
<p> </p>
<p> </p>
<p><b>Naming Conventions </b></p>
<p>The names of the access functions provided by the CanXcp always start with a prefix that </p>
<p>includes </p>
<p>the </p>
<p>characters </p>
<p>‘CanXcp’. </p>
<p>The </p>
<p>characters </p>
<p>‘CanXcp’ </p>
<p>are </p>
<p>surrounded </p>
<p>by </p>
<p>an </p>
<p>abbreviation which refers to the service or to the layer which requests a XCP service. The </p>
<p>designation of the main services is listed below: </p>
<p><b>Naming conventions </b></p>
<p>CanXcp… </p>
<p>It is mandatory to use all functions beginning with Xcp… </p>
<p>These services are called by either the data link layer, XCP Protocol Layer or </p>
<p>the application. </p>
<p>They are e.g. used for the transmission of messages. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>4 </p>
<p>based on template version 5.1.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>We have configured the programs in accordance with your specifications in the </p>
<p>questionnaire. Whereas the programs do support other configurations than the one </p>
<p>specified in your questionnaire, Vector´s release of the programs delivered to your </p>
<p>company is expressly restricted to the configuration you have specified in the </p>
<p>questionnaire. </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>5 </p>
<p>based on template version 5.1.0 </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Overview ....................................................................................................................... 8</b></p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Functional Description ................................................................................................. 9</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>Overview of the Functional Scope ...................................................................... 9</p>
<p> </p>
<p>2.2</p>
<p> </p>
<p>Reception and Transmission of XCP Packets .................................................... 9</p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Integration into the Application ................................................................................. 10</b></p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Files ................................................................................................................. 10</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Version Changes.............................................................................................. 10</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>MainFunction ................................................................................................... 11</p>
<p> </p>
<p>3.4</p>
<p> </p>
<p>Critical Sections / Exclusive Areas ................................................................... 11</p>
<p> </p>
<p>3.4.1</p>
<p> </p>
<p>CANXCP_EXCLUSIVE_AREA_0..................................................... 11</p>
<p> </p>
<p>3.5</p>
<p> </p>
<p>Activation and Deactivation .............................................................................. 11</p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>Description of the API ................................................................................................ 12</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Version of the Source Code ............................................................................. 12</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>XCP on CAN Transport Layer services called by the Protocol Layer ................ 12</p>
<p> </p>
<p>4.2.1</p>
<p> </p>
<p>CanXcp_Send: Transmission of XCP Packets ................................. 12</p>
<p> </p>
<p>4.2.2</p>
<p> </p>
<p>CanXcp_MainFunction: Main Function of XCP on CAN Transport </p>
<p>Layer ................................................................................................ 13</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>XCP Transport Layer for CAN services called by the CAN Interface ................ 14</p>
<p> </p>
<p>4.3.1</p>
<p> </p>
<p>Xcp_CanIfRxIndication: XCP Message Indication Function .............. 14</p>
<p> </p>
<p>4.3.2</p>
<p> </p>
<p>Xcp_CanIfTxConfirmation: XCP Message Confirmation ................... 14</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>XCP Protocol Layer services called by the XCP on CAN Transport Layer ........ 15</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>XCP on CAN Transport Layer services called by other layers .......................... 15</p>
<p> </p>
<p>4.5.1</p>
<p> </p>
<p>CanXcp_Init: Initialization of XCP on CAN Transport Layer .............. 15</p>
<p> </p>
<p>4.5.2</p>
<p> </p>
<p>CanXcp_GetVersionInfo: Request version information of XCP on </p>
<p>CAN Transport Layer ....................................................................... 15</p>
<p> </p>
<p>4.5.3</p>
<p> </p>
<p>CanXcp_SetPduMode: set Transmission mode ............................... 16</p>
<p> </p>
<p>4.6</p>
<p> </p>
<p>Macros ............................................................................................................. 16</p>
<p> </p>
<p>4.6.1</p>
<p> </p>
<p>XCP_ACTIVATE: Enable the Protocol and Transport Layer ............. 16</p>
<p> </p>
<p>4.6.2</p>
<p> </p>
<p>XCP_DEACTIVATE: Disable the Protocol and Transport Layer ........ 17</p>
<p> </p>
<p>4.6.3</p>
<p> </p>
<p>A2L File ............................................................................................ 18</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>Limitations .................................................................................................................. 19</b></p>
<p> </p>
<p>5.1.1</p>
<p> </p>
<p>Assignment of CAN identifiers to DAQ Lists is not supported ........... 19</p>
<p> </p>
<p>5.1.2</p>
<p> </p>
<p>Detection of all XCP Slaves within a Network ................................... 19</p>
<p> </p>
<p>5.1.3</p>
<p> </p>
<p>Multiple Identity only supported for single channel configuration ...... 19</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>6 </p>
<p>based on template version 5.1.0 </p>
<p><b>6</b></p>
<p> </p>
<p><b>FAQ .............................................................................................................................. 20</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Transmit Queue of CAN Interface is Disabled .................................................. 20</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Additions &amp; Extension ...................................................................................... 20</p>
<p> </p>
<p>6.2.1</p>
<p> </p>
<p>CanXcp_InitMemory ......................................................................... 20</p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>Contact ........................................................................................................................ 21</b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>7 </p>
<p>based on template version 5.1.0 </p>
<p>  </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>8 </p>
<p>based on template version 5.1.0 </p>
<p><b>1 </b></p>
<p><b>Overview </b></p>
<p>This document describes the features, API, configuration and integration of the  CanXcp. </p>
<p>The XCP Protocol Layer, which is already described within a separate document [3], is not </p>
<p>covered by this document. </p>
<p>Please </p>
<p>also </p>
<p>refer </p>
<p>to </p>
<p>“The </p>
<p>Universal </p>
<p>Measurement </p>
<p>and </p>
<p>Calibration </p>
<p>Protocol </p>
<p>Family” </p>
<p>specification by ASAM e.V. </p>
<p>XCP on CAN is a hardware independent protocol that can be ported to almost any CAN </p>
<p>controller.  Due  to  there  are  numerous  combinations  of  micro  controllers,  compilers  and </p>
<p>memory  models  it  cannot  be  guaranteed  that  it  will  run  properly  on  any  of  the  above </p>
<p>mentioned combinations. </p>
<p>Please  note  that  in  this  document  the  term Application  is  not  used  strictly  for  the  user </p>
<p>software but also for any higher software layer. Therefore, Application refers to any of the </p>
<p>software components using XCP on CAN. </p>
<p>The API of the functions is described in a separate chapter at the end of this document. </p>
<p>Referred functions are always shown in the single channel mode. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>9 </p>
<p>based on template version 5.1.0 </p>
<p><b>2 </b></p>
<p><b>Functional Description </b></p>
<p><b>2.1 </b></p>
<p><b>Overview of the Functional Scope </b></p>
<p>The transmission and reception of XCP Packets is managed by the XCP Transport Layers. </p>
<p>These use the AUTOSAR CanIf for the transmission and reception of XCP Packets.  </p>
<p> </p>
<p>The message length depends on the PDU size and can be 8 Bytes on CAN or up to 64 </p>
<p>Bytes on CAN-FD (Mode 2). </p>
<p><b>2.2 </b></p>
<p><b>Reception and Transmission of XCP Packets </b></p>
<p>Upon reception of any XCP message the function </p>
<p>void <b>Xcp_CanIfRxIndication </b>( PduIdType CanCanXcpRxPduId,  </p>
<p>const PduInfoType *CanSduPtr ) </p>
<p>(4.3.1) </p>
<p>is called by the CAN Interface and the XCP Packet is passed to the XCP Protocol Layer. </p>
<p>After the command has been processed by the Protocol Layer the XCP Response Packet </p>
<p>is passed to the Transport Layer by the service </p>
<p>void <b>CanXcp_Send </b>(uint8 Xcp_Channel, uint8 len, MEMORY_ROM </p>
<p>BYTEPTR msg ) </p>
<p>(4.2.1) </p>
<p>The XCP message is transmitted via the CAN Interface’s service </p>
<p>uint8 <b>CanIf_Send </b>( PduIdType CanTxPduId,  </p>
<p>const PduInfoType *PduInfoPtr ) </p>
<p>The successful transmission is confirmed by the CAN Interface by a call of </p>
<p>void <b>Xcp_CanIfTxConfirmation </b>( PduIdType CanTxPduId ) </p>
<p>(4.3.2)</p>
<p> </p>
<p>The confirmation is passed from the XCP on Can Transport Layer to the Protocol Layer by </p>
<p>the XcpSendCallback. </p>
<p>Asynchronous XCP Packet transmission like e.g. SERV, EV and DAQ are also transmitted </p>
<p>and confirmed by the above described sequence. </p>
<p>Please </p>
<p>note </p>
<p>that </p>
<p>after </p>
<p>Initialization </p>
<p>the </p>
<p>XCP </p>
<p>is </p>
<p>in </p>
<p>PDU </p>
<p>Mode </p>
<p>CANXCP_SET_OFFLINE. </p>
<p>Normally it is enabled by the CAN State Manager. If the State Manager is not present or a </p>
<p>State Manager from another vendor is used this has to be enabled manually by using the </p>
<p>following API with </p>
<p>CANXCP_SET_ONLINE</p>
<p>: </p>
<p>void <b>CanXcp_SetPduMode </b>( NetworkHandleType XcpNwH, </p>
<p>CanXcp_PduSetModeType PduMode ) </p>
<p>(4.5.3) </p>
<p>If this is not done, the XCP will not send anything!</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>10 </p>
<p>based on template version 5.1.0 </p>
<p><b>3 </b></p>
<p><b>Integration into the Application </b></p>
<p>This chapter describes the steps for the integration of the XCP on CAN Transport Layer </p>
<p>into an application environment of an ECU. </p>
<p><b>3.1 </b></p>
<p><b>Files </b></p>
<p>The XCP on CAN Transport Layer consists of the following files: </p>
<p><b>Files of the XCP on CAN Transport Layer </b></p>
<p>CanXcp.c </p>
<p>XCP on CAN Transport Layer. </p>
<p>This file <b>must not </b>be changed by the user! </p>
<p> </p>
<p>CanXcp.h </p>
<p>API of the XCP on CAN Transport Layer. </p>
<p>This file <b>must not </b>be changed by the application! </p>
<p>This file has to be included prior to </p>
<p>XcpProf.h</p>
<p>. </p>
<p> </p>
<p>CanXcp_Types.h </p>
<p>Type definitions of the XCP on CAN Transport Layer. </p>
<p>This file <b>must not </b>be changed by the application! </p>
<p>This file is handled internally and must not be included </p>
<p>separately. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Additionally the following files are generated by the generation tool GENy. </p>
<p><b>Files generated by GENy </b></p>
<p>CanXcp_Cfg.h </p>
<p>Configuration file for XCP on CAN. </p>
<p>External declarations for the parameters. </p>
<p> </p>
<p>CanXcp_Lcfg.c </p>
<p>Link time parameter definition for the XCP on CAN. </p>
<p> </p>
<p>CanXcp_PBcfg.c </p>
<p>Post build parameter definition for the XCP on CAN. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Note that all files of XCP on CAN must not be changed manually except if not GENy is </p>
<p>used for he configuration of the AUTOSAR CAN Interface. In this case only the generated </p>
<p>files </p>
<p>CanXcp_Cfg.h</p>
<p>, </p>
<p>CanXcp_Lcfg.c</p>
<p> and </p>
<p>CanXcp_PBcfg.c</p>
<p> are relevant. </p>
<p> </p>
<p><b>3.2 </b></p>
<p><b>Version Changes </b></p>
<p>Changes and the release versions of the XCP on CAN Transport Layer are listed at the </p>
<p>beginning of the header and source code. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>11 </p>
<p>based on template version 5.1.0 </p>
<p><b>3.3 </b></p>
<p><b>MainFunction </b></p>
<p>Normally the CanXcp_MainFunction is called cyclically by the Schedule Manager (SchM). </p>
<p>If  no  SchM  is  present  or  a  3</p>
<p>rd</p>
<p>  party  SchM  is  used  the  CanXcp_MainFunction  must  be </p>
<p>called  cyclically  by  the  application. The purpose  of  the  MainFunction  is to  send  queued </p>
<p>messages that failed to be sent immediately. Therefore the call cycle is not very critical. A </p>
<p>call cycle of 5 or 10ms is sufficient in most cases. </p>
<p><b>3.4 </b></p>
<p><b>Critical Sections / Exclusive Areas </b></p>
<p>The XCP makes use of interrupt locking to guarantee atomic operation of critical sections. </p>
<p>For this purpose one exclusive area is defined </p>
<p></p>
<p> </p>
<p>CANXCP_EXCLUSIVE_AREA_0 </p>
<p>The exclusive area must be mapped to interrupt lock and unlock functions which can be </p>
<p>called nested. The exclusive areas are used in the following cases: </p>
<p> </p>
<p><b>3.4.1 </b></p>
<p><b>CANXCP_EXCLUSIVE_AREA_0 </b></p>
<p>This area is used whenever the services Xcp_Event, Xcp_SendCallBack, </p>
<p>Xcp_MainFunction  and  Xcp_Command can interrupt each other. </p>
<p>Please read the Technical Reference XCP Protocol Layer [3] for further information. </p>
<p><b>3.5 </b></p>
<p><b>Activation and Deactivation </b></p>
<p>The XCP provides functionality to disable the component during runtime. This is useful if </p>
<p>the component shall remain in series production ECUs where XCP is disabled by default </p>
<p>and can be enabled by, e.g. a Diagnosis service. </p>
<p>By  default  XCP  is  enabled. The  functionality  of  the  XCP  can  be  disabled  by  calling  the </p>
<p>Macro: </p>
<p><b>XCP_DEACTIVATE()</b></p>
<p> </p>
<p>(4.6.2)</p>
<p> </p>
<p>It can be enabled again by calling the respective Macro: </p>
<p> </p>
<p><b>XCP_ACTIVATE()</b></p>
<p>                                   </p>
<p>(4.6.1)</p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>12 </p>
<p>based on template version 5.1.0 </p>
<p><b>4 </b></p>
<p><b>Description of the API </b></p>
<p>The API of XCP on CAN consists of services, which are realized by function calls. These </p>
<p>services are called wherever they are required. They transfer information to- or take over </p>
<p>information  from  XCP  on  CAN. This  information  is  stored  in  XCP  on  CAN  until  it  is  not </p>
<p>required anymore, respectively until it is changed by other operations. </p>
<p>Examples for calling the services of XCP on CAN can be found in the description of the </p>
<p>services. </p>
<p><b>4.1 </b></p>
<p><b>Version of the Source Code </b></p>
<p>The source code version of the XCP on CAN Transportation Layer is provided by three </p>
<p>BCD coded constants: </p>
<p> </p>
<p>CONST(uint8, CANXCP_CONST) kXcpOnCanAsrMainVersion    = </p>
<p>(uint8)(CP_XCPONCANASR_VERSION &gt;&gt; 8); </p>
<p>CONST(uint8, CANXCP_CONST) kXcpOnCanSubAsrVersion     = </p>
<p>(uint8)(CP_XCPONCANASR_VERSION &amp; 0x00ff); </p>
<p>CONST(uint8, CANXCP_CONST) kXcpOnCanAsrReleaseVersion = </p>
<p>(uint8)(CP_XCPONCANASR_RELEASE_VERSION);  </p>
<p> </p>
<p> </p>
<p><b>Example</b> </p>
<p>Version 1.00.00 is registered as: </p>
<p>kXcpOnCanAsrMainVersion = 0x01; </p>
<p>kXcpOnCanAsrSubVersion = 0x00; </p>
<p>kXcpOnCanAsrReleaseVersion = 0x00;</p>
<p> </p>
<p> </p>
<p>These constants are declared as external and can be read by the application at any time. </p>
<p> </p>
<p><b>4.2 </b></p>
<p><b>XCP on CAN Transport Layer services called by the Protocol Layer </b></p>
<p>The following XCP on CAN Transport Layer functions are called by the Protocol Layer. </p>
<p> </p>
<p>The API of these functions can be found in the header of the XCP on CAN component. </p>
<p> </p>
<p><b>4.2.1 </b></p>
<p><b>CanXcp_Send: Transmission of XCP Packets </b></p>
<p><b>CanXcp_Send </b></p>
<p><b>Prototype </b></p>
<p>void</p>
<p> <b>CanXcp_Send </b></p>
<p>( uint8 Xcp_Channel, uint8 len, const uint8* msg ) </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>13 </p>
<p>based on template version 5.1.0 </p>
<p><b>Parameter </b></p>
<p>Xcp_Channel </p>
<p>Logical channel of the protocol layer. Depending whether Multi Client is </p>
<p>enabled this parameter will always be 0 (Multi Client disabled) or reflect the </p>
<p>logical Xcp channel (Multi Client enabled). </p>
<p>len </p>
<p>Length of the XCP Packet that has to be transmitted. </p>
<p>(with len = 1 ... 8 on CAN and 1..64 on CAN-FD)</p>
<p> </p>
<p>msg </p>
<p>Pointer to the XCP Packet data. </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Request for the transmission of a DTO or CTO message. </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Call context of: XcpEvent, XcpBackground and context of CAN Interface </p>
<p> </p>
<p><b>4.2.2 </b></p>
<p><b>CanXcp_MainFunction: Main Function of XCP on CAN Transport Layer </b></p>
<p><b>CanXcp_MainFunction </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanXcp_MainFunction </b>( void ) </p>
<p><b>Parameter </b></p>
<p>- </p>
<p>- </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Main function of XCP on CAN Transport Layer. </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>14 </p>
<p>based on template version 5.1.0 </p>
<p><b>4.3 </b></p>
<p><b>XCP Transport Layer for CAN services called by the CAN Interface </b></p>
<p>The following XCP on CAN Transport Layer functions are called by the AUTOSAR CAN </p>
<p>Interface. The API of these functions can be found in the header of the CAN Interface’s </p>
<p>parameter file. </p>
<p> </p>
<p><b>4.3.1 </b></p>
<p><b>Xcp_CanIfRxIndication: XCP Message Indication Function  </b></p>
<p><b>Xcp_CanIfRxIndication </b></p>
<p><b>Prototype </b></p>
<p>void <b>Xcp_CanIfRxIndication </b>( PduIdType CanCanXcpRxPduId, const </p>
<p>PduInfoType * PduInfoPtr) </p>
<p><b>Parameter </b></p>
<p>CanCanXcpRxPduId</p>
<p> </p>
<p>Target PDU ID of CAN L-PDU that has been received </p>
<p>PduInfoPtr</p>
<p> </p>
<p>Contains pointer and length to received XCP L-SDU </p>
<p><b>Return code </b></p>
<p>- </p>
<p>-</p>
<p> </p>
<p><b>Functional Description </b></p>
<p>Rx Indication for reception of CTO and DTO Packets. </p>
<p>This function is configured in the generation tool.  </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Call context of CAN Interface </p>
<p> </p>
<p><b>4.3.2 </b></p>
<p><b>Xcp_CanIfTxConfirmation: XCP Message Confirmation </b></p>
<p> </p>
<p><b>Xcp_CanIfTxConfirmation </b></p>
<p><b>Prototype </b></p>
<p>void <b>Xcp_CanIfTxConfirmation </b>( PduIdType CanTxPduId ) </p>
<p><b>Parameter </b></p>
<p>CanTxPduId</p>
<p> </p>
<p>PDU ID of CAN L-PDU transmitted successfully </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Tx Confirmation for successful transmission of CTO and DTO Packets. </p>
<p>This function is configured in the generation tool. </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Call context of CAN Interface </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>15 </p>
<p>based on template version 5.1.0 </p>
<p><b>4.4 </b></p>
<p><b>XCP Protocol Layer services called by the XCP on CAN Transport Layer </b></p>
<p>The following XCP Protocol Layer services are called by the XCP on CAN Transport Layer: </p>
<p>-</p>
<p> </p>
<p>void Xcp_Command( uint8 Xcp_Channel, const uint32* pCommand ) </p>
<p>-</p>
<p> </p>
<p>void Xcp_SendCallBack( uint8 Xcp_Channel ) </p>
<p>-</p>
<p> </p>
<p>void Xcp_SetActiveTl( uint8 Xcp_Channel, uint8 Tl ) </p>
<p>-</p>
<p> </p>
<p>uint8 Xcp_GetActiveTl( uiont8 Xcp_Channel ) </p>
<p>-</p>
<p> </p>
<p>uint8 Xcp_GetSessionStatus( uint8 Xcp_Channel ) </p>
<p> </p>
<p>For  a  description  of  the API  and  the  functionality  of  these  functions  please  refer  to  the </p>
<p>Technical Reference XCP Protocol Layer [3]. </p>
<p> </p>
<p><b>4.5 </b></p>
<p><b>XCP on CAN Transport Layer services called by other layers </b></p>
<p>The following XCP on CAN Transport Layer functions have to be called from other layers. </p>
<p><b>4.5.1 </b></p>
<p><b>CanXcp_Init: Initialization of XCP on CAN Transport Layer </b></p>
<p><b>CanXcp_Init </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanXcp_Init </b>(const CanXcp_ConfigType * ConfigPtr ) </p>
<p><b>Parameter </b></p>
<p>ConfigPtr</p>
<p> </p>
<p>Pointer to the post build configuration </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>Initialization of the XCP on Transport Layer.  </p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Must be called during system initialization </p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Parameter ‘</p>
<p>ConfigPtr</p>
<p>’ is only evaluated for post build configurations. </p>
<p> </p>
<p><b>4.5.2 </b></p>
<p><b>CanXcp_GetVersionInfo: Request version information of XCP on CAN </b></p>
<p><b>Transport Layer </b></p>
<p><b>CanXcp_Init </b></p>
<p><b>Prototype </b></p>
<p>void <b>CanXcp_GetVersionInfo </b>(Std_VersionInfoType * Versioninfo ) </p>
<p><b>Parameter </b></p>
<p>Versioninfo</p>
<p> </p>
<p>Pointer to store the version information </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>16 </p>
<p>based on template version 5.1.0 </p>
<p><b>Return code </b></p>
<p>- </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>CanXcp_GetVersionInfo() returns version information, vendor ID and AUTOSAR module ID of the </p>
<p>component. The versions are BCD-coded. </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>none </p>
<p> </p>
<p><b>4.5.3 </b></p>
<p><b>CanXcp_SetPduMode: set Transmission mode </b></p>
<p><b>CanXcp_SetPduMode </b></p>
<p><b>Prototype </b></p>
<p>void CanXcp_SetPduMode( NetworkHandleType XcpNwH, CanXcp_PduSetModeType PduMode </p>
<p>); </p>
<p><b>Parameters [in/out/both] </b></p>
<p>XcpNwH [in] </p>
<p>The Network Handle which is usually 0</p>
<p> </p>
<p>PduMode </p>
<p>This is the new state. It can either be </p>
<p></p>
<p> </p>
<p>CANXCP_SET_ONLINE</p>
<p> </p>
<p></p>
<p> </p>
<p>CANXCP_SET_OFFLINE</p>
<p> </p>
<p><b>Return code </b></p>
<p>-</p>
<p> </p>
<p>-</p>
<p> </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>7 </p>
<p><b>Functional Description </b></p>
<p>With this service it is possible to prevent transmission of XCP frames, e.g. when the bus is offline. The </p>
<p>frames are not lost but stored in the Send Queue until overrun occurs or transmission is enabled again. </p>
<p><b>Preconditions </b></p>
<p>- </p>
<p><b>Postconditions </b></p>
<p>- </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Call context: task level </p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Synchronous </p>
<p> </p>
<p><b>4.6 </b></p>
<p><b>Macros </b></p>
<p><b>4.6.1 </b></p>
<p><b>XCP_ACTIVATE: Enable the Protocol and Transport Layer </b></p>
<p><b>XCP_ACTIVATE </b></p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>17 </p>
<p>based on template version 5.1.0 </p>
<p><b>Prototype </b></p>
<p>XCP_ACTIVATE(); </p>
<p><b>Parameters [in/out/both] </b></p>
<p>Command [in] </p>
<p>-</p>
<p> </p>
<p><b>Return code </b></p>
<p>-</p>
<p> </p>
<p>-</p>
<p> </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>With this service it is possible to enable all functionality of the XCP Protocol and Transport Layer during </p>
<p>runtime to prevent erroneous execution.  </p>
<p><b>Preconditions </b></p>
<p>- </p>
<p><b>Postconditions </b></p>
<p>- </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Call context: task level </p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Synchronous </p>
<p> </p>
<p><b>4.6.2 </b></p>
<p><b>XCP_DEACTIVATE: Disable the Protocol and Transport Layer </b></p>
<p><b>XCP_DEACTIVATE </b></p>
<p><b>Prototype </b></p>
<p>XCP_DEACTIVATE(); </p>
<p><b>Parameters [in/out/both] </b></p>
<p>Command [in] </p>
<p>-</p>
<p> </p>
<p><b>Return code </b></p>
<p>-</p>
<p> </p>
<p>-</p>
<p> </p>
<p><b>Service ID </b></p>
<p>Service ID </p>
<p>- </p>
<p><b>Functional Description </b></p>
<p>With this service it is possible to lock all functionality of the XCP Protocol and Transport Layer during runtime </p>
<p>to prevent erroneous execution.  </p>
<p><b>Preconditions </b></p>
<p>- </p>
<p><b>Postconditions </b></p>
<p>- </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>18 </p>
<p>based on template version 5.1.0 </p>
<p><b>Particularities and Limitations </b></p>
<p></p>
<p> </p>
<p>Call context: task level </p>
<p></p>
<p> </p>
<p>Not re-entrant </p>
<p></p>
<p> </p>
<p>Synchronous </p>
<p> </p>
<p><b>4.6.3 </b></p>
<p><b>A2L File </b></p>
<p>GENy exports an a2l file for easier configuration of the XCP Master (e.g. CANape). This </p>
<p>file is called CanXCPAsr.a2l and contains the XCP_ON_CAN IF_DATA section which can </p>
<p>be included by a master template a2l file. </p>
<p> </p>
<p><b>Hint! </b></p>
<p></p>
<p> The following abstract can be used to include the generated a2l: </p>
<p>  /begin IF_DATA XCP </p>
<p>    …….. </p>
<p>    /include &quot;CanXCPAsr.a2l&quot; </p>
<p>  /end IF_DATA </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>19 </p>
<p>based on template version 5.1.0 </p>
<p><b>5 </b></p>
<p><b>Limitations </b></p>
<p><b>5.1.1 </b></p>
<p><b>Assignment of CAN identifiers to DAQ Lists is not supported </b></p>
<p>The assignment of CAN identifiers to DAQ lists is not supported. There is only one CAN </p>
<p>identifier </p>
<p>for </p>
<p>CMD/STIM </p>
<p>and </p>
<p>one </p>
<p>CAN </p>
<p>identifier </p>
<p>for </p>
<p>RES/EV/DAQ. </p>
<p>The </p>
<p>command </p>
<p>GET/SET_DAQ_ID is not supported. </p>
<p><b>5.1.2 </b></p>
<p><b>Detection of all XCP Slaves within a Network </b></p>
<p>The detection of all XCP slaves within a network with the command GET_SLAVE_ID is not </p>
<p>supported. </p>
<p><b>5.1.3 </b></p>
<p><b>Multiple Identity only supported for single channel configuration  </b></p>
<p>Multiple Identities for AUTOSAR XCP on CAN is only available for a single CAN channel </p>
<p>configuration. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>20 </p>
<p>based on template version 5.1.0 </p>
<p><b>6 </b></p>
<p><b>FAQ </b></p>
<p><b>6.1 </b></p>
<p><b>Transmit Queue of CAN Interface is Disabled </b></p>
<p> </p>
<p> </p>
<p><b>FAQ</b> </p>
<p>How to operate XCP on CAN if the transmit queue of CanIf is disabled. </p>
<p> </p>
<p>If the transmit queue of CanIf is disabled, at any time it might not be possible to transmit </p>
<p>the  XCP  Slave  message  due  to  an  on-going  message  transmission.  Therefore </p>
<p>the </p>
<p>message transmission might have to be requested several times.  </p>
<p>This is done with the service </p>
<p>CanXcp_MainFunction()</p>
<p>. This service has to be called </p>
<p>cyclically  with  a  recommended  call  cycle  of  1ms. The faster it  gets  called the faster the </p>
<p>XCP Slave message will participate in the arbitration on the bus. </p>
<p><b>6.2 </b></p>
<p><b>Additions &amp; Extension </b></p>
<p><b>6.2.1 </b></p>
<p><b>CanXcp_InitMemory </b></p>
<p>The function CanXcp_InitMemory is an extension to AUTOSAR and must be used when </p>
<p>the memory is not initialized by the startup code. </p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>Technical Reference XCP on CAN </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10.00 </p>
<p>21 </p>
<p>based on template version 5.1.0 </p>
<p><b>7 </b></p>
<p><b>Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p><b>&gt; </b> News </p>
<p><b>&gt; </b> Products </p>
<p><b>&gt; </b> Demo software </p>
<p><b>&gt; </b> Support </p>
<p><b>&gt; </b> Training data </p>
<p><b>&gt; </b> Addresses </p>
<p> </p>
<p><b>www.vector.com </b></p>
</body>
</html>
{% endraw %}